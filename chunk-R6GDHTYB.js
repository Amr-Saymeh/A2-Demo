import{a as i,b as l,g as u,j as h}from"./chunk-PGPO4HR4.js";import{e as s}from"./chunk-46AQF2XH.js";var g=class{getAllRestaurants(){return s(this,null,function*(){try{let t=i(h),a=yield u(l(t,"restaurants"));return a.exists()?a.val():null}catch(t){throw console.error("Error fetching restaurants:",t),t}})}getRestaurantById(t){return s(this,null,function*(){let a=this.cacheKeyRestaurant(t),e=this.getCache(a);try{let r=yield this.getRemoteLastMenuUpdateAt(t);if(r==null&&e?.data||e&&e.data&&r!=null&&e.lastUpdateAt===r)return e.data;let n=i(h),c=yield u(l(n,`restaurants/${t}`));if(c.exists()){let o=c.val();return this.setCache(a,{data:o,lastUpdateAt:r??Date.now()}),o}return null}catch(r){if(e?.data)return e.data;throw console.error(`Error fetching restaurant ${t}:`,r),r}})}getCategories(t){return s(this,null,function*(){let a=this.cacheKeyCategories(t),e=this.getCache(a);try{let r=yield this.getRemoteLastMenuUpdateAt(t);if(r==null&&e?.data||e&&e.data&&r!=null&&e.lastUpdateAt===r)return e.data;let n=i(h),c=yield u(l(n,`restaurants/${t}/menu/categories`));if(c.exists()){let o=c.val();return this.setCache(a,{data:o,lastUpdateAt:r??Date.now()}),o}return e?.data?e.data:null}catch(r){if(e?.data)return e.data;throw console.error(`Error fetching categories for ${t}:`,r),r}})}getCategory(t,a){return s(this,null,function*(){let e=yield this.getCategories(t);return e?e[a]??null:null})}getCategoriesFromCache(t){let a=this.cacheKeyCategories(t);return this.getCache(a)?.data??null}getCategoryFromCache(t,a){let e=this.getCategoriesFromCache(t);return e?e[a]??null:null}prefix="ty-cache:v1";cacheKeyRestaurant(t){return`${this.prefix}:restaurants:${t}:data`}cacheKeyCategories(t){return`${this.prefix}:restaurants:${t}:menu:categories`}getCache(t){try{let a=localStorage.getItem(t);return a?JSON.parse(a):null}catch{return null}}setCache(t,a){try{localStorage.setItem(t,JSON.stringify(a))}catch{}}getRemoteLastMenuUpdateAt(t){return s(this,null,function*(){try{let a=i(h),e=yield u(l(a,`restaurants/${t}/meta/lastMenuUpdateAt`));if(e.exists()){let r=e.val(),n=typeof r=="number"?r:Number(r);return isFinite(n)?n:null}return null}catch{return null}})}},p=new g;export{p as a};
