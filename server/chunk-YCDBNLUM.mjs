import './polyfills.server.mjs';
import{a as kr,b as Pr,c as T,e as b,f as Wc,h as D}from"./chunk-S6KH3LOX.mjs";var Q=b((si,Mr)=>{"use strict";var Jt=T("buffer"),Y=Jt.Buffer;function Dr(t,e){for(var n in t)e[n]=t[n]}Y.from&&Y.alloc&&Y.allocUnsafe&&Y.allocUnsafeSlow?Mr.exports=Jt:(Dr(Jt,si),si.Buffer=ye);function ye(t,e,n){return Y(t,e,n)}ye.prototype=Object.create(Y.prototype);Dr(Y,ye);ye.from=function(t,e,n){if(typeof t=="number")throw new TypeError("Argument must not be a number");return Y(t,e,n)};ye.alloc=function(t,e,n){if(typeof t!="number")throw new TypeError("Argument must be a number");var i=Y(t);return e!==void 0?typeof n=="string"?i.fill(e,n):i.fill(e):i.fill(0),i};ye.allocUnsafe=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return Y(t)};ye.allocUnsafeSlow=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return Jt.SlowBuffer(t)}});var Br=b(ri=>{"use strict";var Lr=T("stream").Stream,Fr=T("util"),Ee=function(t){this.readable=this.writable=!0,this._paused=!1,this._driver=t};Fr.inherits(Ee,Lr);Ee.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0};Ee.prototype.resume=function(){this._paused=!1,this.emit("drain");var t=this._driver.messages;t._paused=!1,t.emit("drain")};Ee.prototype.write=function(t){return this.writable?(this._driver.parse(t),!this._paused):!1};Ee.prototype.end=function(t){if(this.writable){t!==void 0&&this.write(t),this.writable=!1;var e=this._driver.messages;e.readable&&(e.readable=e.writable=!1,e.emit("end"))}};Ee.prototype.destroy=function(){this.end()};var Ce=function(t){this.readable=this.writable=!0,this._paused=!1,this._driver=t};Fr.inherits(Ce,Lr);Ce.prototype.pause=function(){this._driver.io._paused=!0};Ce.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")};Ce.prototype.write=function(t){return this.writable?(typeof t=="string"?this._driver.text(t):this._driver.binary(t),!this._paused):!1};Ce.prototype.end=function(t){t!==void 0&&this.write(t)};Ce.prototype.destroy=function(){};ri.IO=Ee;ri.Messages=Ce});var en=b((J_,Ur)=>{"use strict";var Be=function(){this.clear()};Be.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"];Be.prototype.clear=function(){this._sent={},this._lines=[]};Be.prototype.set=function(t,e){if(e!==void 0){t=this._strip(t),e=this._strip(e);var n=t.toLowerCase();(!this._sent.hasOwnProperty(n)||this.ALLOWED_DUPLICATES.indexOf(n)>=0)&&(this._sent[n]=!0,this._lines.push(t+": "+e+`\r
`))}};Be.prototype.toString=function(){return this._lines.join("")};Be.prototype._strip=function(t){return t.toString().replace(/^ */,"").replace(/ *$/,"")};Ur.exports=Be});var Wr=b((ep,Hr)=>{"use strict";var tn=Q().Buffer,nn=function(){this._queue=[],this._queueSize=0,this._offset=0};nn.prototype.put=function(t){!t||t.length===0||(tn.isBuffer(t)||(t=tn.from(t)),this._queue.push(t),this._queueSize+=t.length)};nn.prototype.read=function(t){if(t>this._queueSize)return null;if(t===0)return tn.alloc(0);this._queueSize-=t;var e=this._queue,n=t,i=e[0],s,r;if(i.length>=t)return i.length===t?e.shift():(r=i.slice(0,t),e[0]=i.slice(t),r);for(var o=0,a=e.length;o<a&&!(n<e[o].length);o++)n-=e[o].length;return s=e.splice(0,o),n>0&&e.length>0&&(s.push(e[0].slice(0,n)),e[0]=e[0].slice(n)),tn.concat(s,t)};nn.prototype.eachByte=function(t,e){for(var n,i,s;this._queue.length>0;){for(n=this._queue[0],i=n.length;this._offset<i;)s=this._offset,this._offset+=1,t.call(e,n[s]);this._offset=0,this._queue.shift()}};Hr.exports=nn});var le=b((tp,$r)=>{"use strict";var qr=Q().Buffer,Gr=T("events").EventEmitter,qc=T("util"),Vr=Br(),jr=en(),Vc=Wr(),F=function(t,e,n){Gr.call(this),F.validateOptions(n||{},["maxLength","masking","requireMasking","protocols"]),this._request=t,this._reader=new Vc,this._options=n||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new jr,this.__queue=[],this.readyState=0,this.url=e,this.io=new Vr.IO(this),this.messages=new Vr.Messages(this),this._bindEventListeners()};qc.inherits(F,Gr);F.isWebSocket=function(t){var e=t.headers.connection||"",n=t.headers.upgrade||"";return t.method==="GET"&&e.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&n.toLowerCase()==="websocket"};F.validateOptions=function(t,e){for(var n in t)if(e.indexOf(n)<0)throw new Error("Unrecognized option: "+n)};var zr={MAX_LENGTH:67108863,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var t=this;this.messages.on("error",function(){}),this.on("message",function(e){var n=t.messages;n.readable&&n.emit("data",e.data)}),this.on("error",function(e){var n=t.messages;n.readable&&n.emit("error",e)}),this.on("close",function(){var e=t.messages;e.readable&&(e.readable=e.writable=!1,e.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(t){return!1},setHeader:function(t,e){return this.readyState>0?!1:(this._headers.set(t,e),!0)},start:function(){if(this.readyState!==0)return!1;if(!F.isWebSocket(this._request))return this._failHandshake(new Error("Not a WebSocket request"));var t;try{t=this._handshakeResponse()}catch(e){return this._failHandshake(e)}return this._write(t),this._stage!==-1&&this._open(),!0},_failHandshake:function(t){var e=new jr;return e.set("Content-Type","text/plain"),e.set("Content-Length",qr.byteLength(t.message,"utf8")),e=["HTTP/1.1 400 Bad Request",e.toString(),t.message],this._write(qr.from(e.join(`\r
`),"utf8")),this._fail("protocol_error",t.message),!1},text:function(t){return this.frame(t)},binary:function(t){return!1},ping:function(){return!1},pong:function(){return!1},close:function(t,e){return this.readyState!==1?!1:(this.readyState=3,this.emit("close",new F.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(t){this.frame.apply(this,t)},this),this.__queue=[],this.emit("open",new F.OpenEvent)},_queue:function(t){return this.__queue.push(t),!0},_write:function(t){var e=this.io;e.readable&&e.emit("data",t)},_fail:function(t,e){this.readyState=2,this.emit("error",new Error(e)),this.close()}};for(oi in zr)F.prototype[oi]=zr[oi];var oi;F.ConnectEvent=function(){};F.OpenEvent=function(){};F.CloseEvent=function(t,e){this.code=t,this.reason=e};F.MessageEvent=function(t){this.data=t};F.PingEvent=function(t){this.data=t};F.PongEvent=function(t){this.data=t};$r.exports=F});var Zr=b(ci=>{"use strict";ci.HTTPParser=m;function m(t){if(t!==void 0&&t!==m.REQUEST&&t!==m.RESPONSE)throw new Error("type must be REQUEST or RESPONSE");t===void 0||this.initialize(t),this.maxHeaderSize=m.maxHeaderSize}m.prototype.initialize=function(t,e){if(t!==m.REQUEST&&t!==m.RESPONSE)throw new Error("type must be REQUEST or RESPONSE");this.type=t,this.state=t+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1};m.encoding="ascii";m.maxHeaderSize=80*1024;m.REQUEST="REQUEST";m.RESPONSE="RESPONSE";var Kr=m.kOnHeaders=1,ai=m.kOnHeadersComplete=2,sn=m.kOnBody=3,li=m.kOnMessageComplete=4;m.prototype[Kr]=m.prototype[ai]=m.prototype[sn]=m.prototype[li]=function(){};var Yr=!0;Object.defineProperty(m,"kOnExecute",{get:function(){return Yr=!1,99}});var Qr=ci.methods=m.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],Xr=Qr.indexOf("CONNECT");m.prototype.reinitialize=m;m.prototype.close=m.prototype.pause=m.prototype.resume=m.prototype.remove=m.prototype.free=function(){};m.prototype._compatMode0_11=!1;m.prototype.getAsyncId=function(){return 0};var zc={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};m.prototype.execute=function(t,e,n){if(!(this instanceof m))throw new TypeError("not a HTTPParser");e=e||0,n=typeof n=="number"?n:t.length,this.chunk=t,this.offset=e;var i=this.end=e+n;try{for(;this.offset<i&&!this[this.state](););}catch(s){if(this.isUserCall)throw s;return this.hadError=!0,s}return this.chunk=null,n=this.offset-e,zc[this.state]&&(this.headerSize+=n,this.headerSize>(this.maxHeaderSize||m.maxHeaderSize))?new Error("max header size exceeded"):n};var Gc={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};m.prototype.finish=function(){if(!this.hadError){if(!Gc[this.state])return new Error("invalid state for EOF");this.state==="BODY_RAW"&&this.userCall()(this[li]())}};m.prototype.consume=m.prototype.unconsume=m.prototype.getCurrentBuffer=function(){};m.prototype.userCall=function(){this.isUserCall=!0;var t=this;return function(e){return t.isUserCall=!1,e}};m.prototype.nextRequest=function(){this.userCall()(this[li]()),this.reinitialize(this.type)};m.prototype.consumeLine=function(){for(var t=this.end,e=this.chunk,n=this.offset;n<t;n++)if(e[n]===10){var i=this.line+e.toString(m.encoding,this.offset,n);return i.charAt(i.length-1)==="\r"&&(i=i.substr(0,i.length-1)),this.line="",this.offset=n+1,i}this.line+=e.toString(m.encoding,this.offset,this.end),this.offset=this.end};var jc=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,$c=/^[ \t]+(.*[^ \t])/;m.prototype.parseHeader=function(t,e){if(t.indexOf("\r")!==-1)throw rn("HPE_LF_EXPECTED");var n=jc.exec(t),i=n&&n[1];if(i)e.push(i),e.push(n[2]);else{var s=$c.exec(t);s&&e.length&&(e[e.length-1]&&(e[e.length-1]+=" "),e[e.length-1]+=s[1])}};var Kc=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;m.prototype.REQUEST_LINE=function(){var t=this.consumeLine();if(t){var e=Kc.exec(t);if(e===null)throw rn("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?e[1]:Qr.indexOf(e[1]),this.info.method===-1)throw new Error("invalid request method");this.info.url=e[2],this.info.versionMajor=+e[3],this.info.versionMinor=+e[4],this.body_bytes=0,this.state="HEADER"}};var Yc=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;m.prototype.RESPONSE_LINE=function(){var t=this.consumeLine();if(t){var e=Yc.exec(t);if(e===null)throw rn("HPE_INVALID_CONSTANT");this.info.versionMajor=+e[1],this.info.versionMinor=+e[2];var n=this.info.statusCode=+e[3];this.info.statusMessage=e[4],((n/100|0)===1||n===204||n===304)&&(this.body_bytes=0),this.state="HEADER"}};m.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(this.connection.indexOf("close")!==-1)return!1}else if(this.connection.indexOf("keep-alive")===-1)return!1;return!!(this.body_bytes!==null||this.isChunked)};m.prototype.HEADER=function(){var t=this.consumeLine();if(t!==void 0){var e=this.info;if(t)this.parseHeader(t,e.headers);else{for(var n=e.headers,i=!1,s,r=!1,o=0;o<n.length;o+=2)switch(n[o].toLowerCase()){case"transfer-encoding":this.isChunked=n[o+1].toLowerCase()==="chunked";break;case"content-length":if(s=+n[o+1],i){if(s!==this.body_bytes)throw rn("HPE_UNEXPECTED_CONTENT_LENGTH")}else i=!0,this.body_bytes=s;break;case"connection":this.connection+=n[o+1].toLowerCase();break;case"upgrade":r=!0;break}this.isChunked&&i&&(i=!1,this.body_bytes=null),r&&this.connection.indexOf("upgrade")!=-1?e.upgrade=this.type===m.REQUEST||e.statusCode===101:e.upgrade=e.method===Xr,this.isChunked&&e.upgrade&&(this.isChunked=!1),e.shouldKeepAlive=this.shouldKeepAlive();var a;if(Yr?a=this.userCall()(this[ai](e)):a=this.userCall()(this[ai](e.versionMajor,e.versionMinor,e.headers,e.method,e.url,e.statusCode,e.statusMessage,e.upgrade,e.shouldKeepAlive)),a===2)return this.nextRequest(),!0;if(this.isChunked&&!a)this.state="BODY_CHUNKHEAD";else{if(a||this.body_bytes===0)return this.nextRequest(),e.upgrade;this.body_bytes===null?this.state="BODY_RAW":this.state="BODY_SIZED"}}}};m.prototype.BODY_CHUNKHEAD=function(){var t=this.consumeLine();t!==void 0&&(this.body_bytes=parseInt(t,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")};m.prototype.BODY_CHUNK=function(){var t=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[sn](this.chunk.slice(this.offset,this.offset+t),0,t)),this.offset+=t,this.body_bytes-=t,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")};m.prototype.BODY_CHUNKEMPTYLINE=function(){var t=this.consumeLine();if(t!==void 0){if(t!=="")throw new Error("Expected empty line");this.state="BODY_CHUNKHEAD"}};m.prototype.BODY_CHUNKTRAILERS=function(){var t=this.consumeLine();t!==void 0&&(t?this.parseHeader(t,this.trailers):(this.trailers.length&&this.userCall()(this[Kr](this.trailers,"")),this.nextRequest()))};m.prototype.BODY_RAW=function(){this.userCall()(this[sn](this.chunk.slice(this.offset,this.end),0,this.end-this.offset)),this.offset=this.end};m.prototype.BODY_SIZED=function(){var t=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[sn](this.chunk.slice(this.offset,this.offset+t),0,t)),this.offset+=t,this.body_bytes-=t,this.body_bytes||this.nextRequest()};["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(t){var e=m["kOn"+t];Object.defineProperty(m.prototype,"on"+t,{get:function(){return this[e]},set:function(n){return this._compatMode0_11=!0,Xr="CONNECT",this[e]=n}})});function rn(t){var e=new Error("Parse Error");return e.code=t,e}});var an=b((ip,eo)=>{"use strict";var on=Zr().HTTPParser,Qc=Q().Buffer,Xc={request:on.REQUEST||"request",response:on.RESPONSE||"response"},B=function(t){this._type=t,this._parser=new on(Xc[t]),this._complete=!1,this.headers={};var e=null,n=this;this._parser.onHeaderField=function(i,s,r){e=i.toString("utf8",s,s+r).toLowerCase()},this._parser.onHeaderValue=function(i,s,r){var o=i.toString("utf8",s,s+r);n.headers.hasOwnProperty(e)?n.headers[e]+=", "+o:n.headers[e]=o},this._parser.onHeadersComplete=this._parser[on.kOnHeadersComplete]=function(i,s,r,o,a,l){var c=arguments[0];if(typeof c=="object"&&(o=c.method,a=c.url,l=c.statusCode,r=c.headers),n.method=typeof o=="number"?B.METHODS[o]:o,n.statusCode=l,n.url=a,!!r){for(var d=0,u=r.length,h,_;d<u;d+=2)h=r[d].toLowerCase(),_=r[d+1],n.headers.hasOwnProperty(h)?n.headers[h]+=", "+_:n.headers[h]=_;n._complete=!0}}};B.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var Jr=process.version?process.version.match(/[0-9]+/g).map(function(t){return parseInt(t,10)}):[];Jr[0]===0&&Jr[1]===12&&(B.METHODS[16]="REPORT",B.METHODS[17]="MKACTIVITY",B.METHODS[18]="CHECKOUT",B.METHODS[19]="MERGE",B.METHODS[20]="M-SEARCH",B.METHODS[21]="NOTIFY",B.METHODS[22]="SUBSCRIBE",B.METHODS[23]="UNSUBSCRIBE",B.METHODS[24]="PATCH",B.METHODS[25]="PURGE");B.prototype.isComplete=function(){return this._complete};B.prototype.parse=function(t){var e=this._parser.execute(t,0,t.length);if(typeof e!="number"){this.error=e,this._complete=!0;return}this._complete&&(this.body=e<t.length?t.slice(e):Qc.alloc(0))};eo.exports=B});var io=b((sp,no)=>{"use strict";var hi=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,Zc=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,Jc=/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/,ui=new RegExp(hi.source+"(?:=(?:"+hi.source+"|"+Jc.source+"))?"),di=new RegExp(hi.source+"(?: *; *"+ui.source+")*","g"),eh=new RegExp("^"+di.source+"(?: *, *"+di.source+")*$"),th=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,to=Object.prototype.hasOwnProperty,nh={parseHeader:function(t){var e=new at;if(t===""||t===void 0)return e;if(!eh.test(t))throw new SyntaxError("Invalid Sec-WebSocket-Extensions header: "+t);var n=t.match(di);return n.forEach(function(i){var s=i.match(new RegExp(ui.source,"g")),r=s.shift(),o={};s.forEach(function(a){var l=a.match(ui),c=l[1],d;l[2]!==void 0?d=l[2]:l[3]!==void 0?d=l[3].replace(/\\/g,""):d=!0,th.test(d)&&(d=parseFloat(d)),to.call(o,c)?(o[c]=[].concat(o[c]),o[c].push(d)):o[c]=d},this),e.push(r,o)},this),e},serializeParams:function(t,e){var n=[],i=function(r,o){o instanceof Array?o.forEach(function(a){i(r,a)}):o===!0?n.push(r):typeof o=="number"?n.push(r+"="+o):Zc.test(o)?n.push(r+'="'+o.replace(/"/g,'\\"')+'"'):n.push(r+"="+o)};for(var s in e)i(s,e[s]);return[t].concat(n).join("; ")}},at=function(){this._byName={},this._inOrder=[]};at.prototype.push=function(t,e){to.call(this._byName,t)||(this._byName[t]=[]),this._byName[t].push(e),this._inOrder.push({name:t,params:e})};at.prototype.eachOffer=function(t,e){for(var n=this._inOrder,i=0,s=n.length;i<s;i++)t.call(e,n[i].name,n[i].params)};at.prototype.byName=function(t){return this._byName[t]||[]};at.prototype.toArray=function(){return this._inOrder.slice()};no.exports=nh});var fi=b((rp,so)=>{"use strict";var lt=function(t){this._bufferSize=t,this.clear()};lt.prototype.clear=function(){this._buffer=new Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0};lt.prototype.push=function(t){var e=!1,n=!1;this._ringSize<this._bufferSize?e=this._tail===0:this._ringOffset===this._ringSize&&(e=!0,n=this._tail===0),e&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(new Array(this._bufferSize)),this._bufferSize=this._buffer.length,n&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=t,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize};lt.prototype.peek=function(){if(this.length!==0)return this._buffer[this._head]};lt.prototype.shift=function(){if(this.length!==0){var t=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,this._ringOffset===0&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,t}};so.exports=lt});var oo=b((op,ro)=>{"use strict";var ih=fi(),Ue=function(t,e){this._session=t,this._method=e,this._queue=new ih(Ue.QUEUE_SIZE),this._stopped=!1,this.pending=0};Ue.QUEUE_SIZE=8;Ue.prototype.call=function(t,e,n,i){if(!this._stopped){var s={error:t,message:e,callback:n,context:i,done:!1},r=!1,o=this;if(this._queue.push(s),s.error)return s.done=!0,this._stop(),this._flushQueue();var a=function(l,c){r^(r=!0)&&(l?(o._stop(),s.error=l,s.message=null):s.message=c,s.done=!0,o._flushQueue())};try{this._session[this._method](e,a)}catch(l){a(l)}}};Ue.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0};Ue.prototype._flushQueue=function(){for(var t=this._queue,e;t.length>0&&t.peek().done;)e=t.shift(),e.error?(this.pending=0,t.clear()):this.pending-=1,e.callback.call(e.context,e.error,e.message)};ro.exports=Ue});var _i=b((ap,ao)=>{"use strict";var sh=fi(),we=function(){this._complete=!1,this._callbacks=new sh(we.QUEUE_SIZE)};we.QUEUE_SIZE=4;we.all=function(t){var e=new we,n=t.length,i=n;for(n===0&&e.done();i--;)t[i].then(function(){n-=1,n===0&&e.done()});return e};we.prototype.then=function(t){this._complete?t():this._callbacks.push(t)};we.prototype.done=function(){this._complete=!0;for(var t=this._callbacks,e;e=t.shift();)e()};ao.exports=we});var ho=b((lp,co)=>{"use strict";var lo=oo(),rh=_i(),Se=function(t){this._ext=t[0],this._session=t[1],this._functors={incoming:new lo(this._session,"processIncomingMessage"),outgoing:new lo(this._session,"processOutgoingMessage")}};Se.prototype.pending=function(t){var e=this._functors[t];e._stopped||(e.pending+=1)};Se.prototype.incoming=function(t,e,n,i){this._exec("incoming",t,e,n,i)};Se.prototype.outgoing=function(t,e,n,i){this._exec("outgoing",t,e,n,i)};Se.prototype.close=function(){return this._closed=this._closed||new rh,this._doClose(),this._closed};Se.prototype._exec=function(t,e,n,i,s){this._functors[t].call(e,n,function(r,o){r&&(r.message=this._ext.name+": "+r.message),i.call(s,r,o),this._doClose()},this)};Se.prototype._doClose=function(){var t=this._functors.incoming,e=this._functors.outgoing;!this._closed||t.pending+e.pending!==0||(this._session&&this._session.close(),this._session=null,this._closed.done())};co.exports=Se});var fo=b((cp,uo)=>{"use strict";var oh=ho(),ah=_i(),ct=function(t){this._cells=t.map(function(e){return new oh(e)}),this._stopped={incoming:!1,outgoing:!1}};ct.prototype.processIncomingMessage=function(t,e,n){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,t,e,n)};ct.prototype.processOutgoingMessage=function(t,e,n){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,t,e,n)};ct.prototype.close=function(t,e){this._stopped={incoming:!0,outgoing:!0};var n=this._cells.map(function(i){return i.close()});t&&ah.all(n).then(function(){t.call(e)})};ct.prototype._loop=function(t,e,n,i,s,r,o){for(var a=this._cells,l=a.length,c=this;l--;)a[l].pending(t);var d=function(u,h,_){if(u===n)return r.call(o,h,_);a[u][t](h,_,function(p,C){p&&(c._stopped[t]=!0),d(u+i,p,C)})};d(e,null,s)};uo.exports=ct});var go=b((hp,mo)=>{"use strict";var ht=io(),_o=fo(),ln=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};ln.MESSAGE_OPCODES=[1,2];var po={add:function(t){if(typeof t.name!="string")throw new TypeError("extension.name must be a string");if(t.type!=="permessage")throw new TypeError('extension.type must be "permessage"');if(typeof t.rsv1!="boolean")throw new TypeError("extension.rsv1 must be true or false");if(typeof t.rsv2!="boolean")throw new TypeError("extension.rsv2 must be true or false");if(typeof t.rsv3!="boolean")throw new TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(t.name))throw new TypeError('An extension with name "'+t.name+'" is already registered');this._byName[t.name]=t,this._inOrder.push(t)},generateOffer:function(){var t=[],e=[],n={};return this._inOrder.forEach(function(i){var s=i.createClientSession();if(s){var r=[i,s];t.push(r),n[i.name]=r;var o=s.generateOffer();o=o?[].concat(o):[],o.forEach(function(a){e.push(ht.serializeParams(i.name,a))},this)}},this),this._sessions=t,this._index=n,e.length>0?e.join(", "):null},activate:function(t){var e=ht.parseHeader(t),n=[];e.eachOffer(function(i,s){var r=this._index[i];if(!r)throw new Error('Server sent an extension response for unknown extension "'+i+'"');var o=r[0],a=r[1],l=this._reserved(o);if(l)throw new Error("Server sent two extension responses that use the RSV"+l[0]+' bit: "'+l[1]+'" and "'+o.name+'"');if(a.activate(s)!==!0)throw new Error("Server sent unacceptable extension parameters: "+ht.serializeParams(i,s));this._reserve(o),n.push(r)},this),this._sessions=n,this._pipeline=new _o(n)},generateResponse:function(t){var e=[],n=[],i=ht.parseHeader(t);return this._inOrder.forEach(function(s){var r=i.byName(s.name);if(!(r.length===0||this._reserved(s))){var o=s.createServerSession(r);o&&(this._reserve(s),e.push([s,o]),n.push(ht.serializeParams(s.name,o.generateResponse())))}},this),this._sessions=e,this._pipeline=new _o(e),n.length>0?n.join(", "):null},validFrameRsv:function(t){var e={rsv1:!1,rsv2:!1,rsv3:!1},n;if(ln.MESSAGE_OPCODES.indexOf(t.opcode)>=0)for(var i=0,s=this._sessions.length;i<s;i++)n=this._sessions[i][0],e.rsv1=e.rsv1||n.rsv1,e.rsv2=e.rsv2||n.rsv2,e.rsv3=e.rsv3||n.rsv3;return(e.rsv1||!t.rsv1)&&(e.rsv2||!t.rsv2)&&(e.rsv3||!t.rsv3)},processIncomingMessage:function(t,e,n){this._pipeline.processIncomingMessage(t,e,n)},processOutgoingMessage:function(t,e,n){this._pipeline.processOutgoingMessage(t,e,n)},close:function(t,e){if(!this._pipeline)return t.call(e);this._pipeline.close(t,e)},_reserve:function(t){this._rsv1=this._rsv1||t.rsv1&&t.name,this._rsv2=this._rsv2||t.rsv2&&t.name,this._rsv3=this._rsv3||t.rsv3&&t.name},_reserved:function(t){return this._rsv1&&t.rsv1?[1,this._rsv1]:this._rsv2&&t.rsv2?[2,this._rsv2]:this._rsv3&&t.rsv3?[3,this._rsv3]:!1}};for(pi in po)ln.prototype[pi]=po[pi];var pi;mo.exports=ln});var Co=b((up,Eo)=>{"use strict";var yo=function(){},vo={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(mi in vo)yo.prototype[mi]=vo[mi];var mi;Eo.exports=yo});var To=b((dp,bo)=>{"use strict";var lh=Q().Buffer,So=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},wo={read:function(){return this.data=this.data||lh.concat(this._chunks,this.length)},pushFrame:function(t){this.rsv1=this.rsv1||t.rsv1,this.rsv2=this.rsv2||t.rsv2,this.rsv3=this.rsv3||t.rsv3,this.opcode===null&&(this.opcode=t.opcode),this._chunks.push(t.payload),this.length+=t.length}};for(gi in wo)So.prototype[gi]=wo[gi];var gi;bo.exports=So});var yi=b((fp,Oo)=>{"use strict";var ut=Q().Buffer,Ro=T("crypto"),ch=T("util"),hh=go(),be=le(),Io=Co(),No=To(),q=function(t,e,n){if(be.apply(this,arguments),this._extensions=new hh,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},typeof this._protocols=="string"&&(this._protocols=this._protocols.split(/ *, */)),!!this._request){var i=this._request.headers["sec-websocket-protocol"],s=this._protocols;i!==void 0&&(typeof i=="string"&&(i=i.split(/ *, */)),this.protocol=i.filter(function(r){return s.indexOf(r)>=0})[0]),this.version="hybi-"+q.VERSION}};ch.inherits(q,be);q.VERSION="13";q.mask=function(t,e,n){if(!e||e.length===0)return t;n=n||0;for(var i=0,s=t.length-n;i<s;i++)t[n+i]=t[n+i]^e[i%4];return t};q.generateAccept=function(t){var e=Ro.createHash("sha1");return e.update(t+q.GUID),e.digest("base64")};q.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var xo={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(t){return this._extensions.add(t),!0},parse:function(t){this._reader.put(t);for(var e=!0;e;)switch(this._stage){case 0:e=this._reader.read(1),e&&this._parseOpcode(e[0]);break;case 1:e=this._reader.read(1),e&&this._parseLength(e[0]);break;case 2:e=this._reader.read(this._frame.lengthBytes),e&&this._parseExtendedLength(e);break;case 3:e=this._reader.read(4),e&&(this._stage=4,this._frame.maskingKey=e);break;case 4:e=this._reader.read(this._frame.length),e&&(this._stage=0,this._emitFrame(e));break;default:e=null}},text:function(t){return this.readyState>1?!1:this.frame(t,"text")},binary:function(t){return this.readyState>1?!1:this.frame(t,"binary")},ping:function(t,e){return this.readyState>1?!1:(t=t||"",e&&(this._pingCallbacks[t]=e),this.frame(t,"ping"))},pong:function(t){return this.readyState>1?!1:(t=t||"",this.frame(t,"pong"))},close:function(t,e){return t=t||"",e=e||this.ERRORS.normal_closure,this.readyState<=0?(this.readyState=3,this.emit("close",new be.CloseEvent(e,t)),!0):this.readyState===1?(this.readyState=2,this._extensions.close(function(){this.frame(t,"close",e)},this),!0):!1},frame:function(t,e,n){if(this.readyState<=0)return this._queue([t,e,n]);if(this.readyState>2)return!1;t instanceof Array&&(t=ut.from(t)),typeof t=="number"&&(t=t.toString());var i=new No,s=typeof t=="string",r,o;i.rsv1=i.rsv2=i.rsv3=!1,i.opcode=this.OPCODES[e||(s?"text":"binary")],r=s?ut.from(t,"utf8"):t,n&&(o=r,r=ut.allocUnsafe(2+o.length),r.writeUInt16BE(n,0),o.copy(r,2)),i.data=r;var a=function(l){var c=new Io;c.final=!0,c.rsv1=l.rsv1,c.rsv2=l.rsv2,c.rsv3=l.rsv3,c.opcode=l.opcode,c.masked=!!this._masking,c.length=l.data.length,c.payload=l.data,c.masked&&(c.maskingKey=Ro.randomBytes(4)),this._sendFrame(c)};return this.MESSAGE_OPCODES.indexOf(i.opcode)>=0?this._extensions.processOutgoingMessage(i,function(l,c){if(l)return this._fail("extension_error",l.message);a.call(this,c)},this):a.call(this,i),!0},_sendFrame:function(t){var e=t.length,n=e<=125?2:e<=65535?4:10,i=n+(t.masked?4:0),s=ut.allocUnsafe(i+e),r=t.masked?this.MASK:0;s[0]=(t.final?this.FIN:0)|(t.rsv1?this.RSV1:0)|(t.rsv2?this.RSV2:0)|(t.rsv3?this.RSV3:0)|t.opcode,e<=125?s[1]=r|e:e<=65535?(s[1]=r|126,s.writeUInt16BE(e,2)):(s[1]=r|127,s.writeUInt32BE(Math.floor(e/4294967296),2),s.writeUInt32BE(e%4294967296,6)),t.payload.copy(s,i),t.masked&&(t.maskingKey.copy(s,n),q.mask(s,t.maskingKey,i)),this._write(s)},_handshakeResponse:function(){var t=this._request.headers["sec-websocket-key"],e=this._request.headers["sec-websocket-version"];if(e!==q.VERSION)throw new Error("Unsupported WebSocket version: "+e);if(typeof t!="string")throw new Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",q.generateAccept(t)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var n=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);n&&this._headers.set("Sec-WebSocket-Extensions",n);var i="HTTP/1.1 101 Switching Protocols",s=[i,this._headers.toString(),""];return ut.from(s.join(`\r
`),"utf8")},_shutdown:function(t,e,n){delete this._frame,delete this._message,this._stage=5;var i=this.readyState===1;this.readyState=2,this._extensions.close(function(){i&&this.frame(e,"close",t),this.readyState=3,n&&this.emit("error",new Error(e)),this.emit("close",new be.CloseEvent(t,e))},this)},_fail:function(t,e){this.readyState>1||this._shutdown(this.ERRORS[t],e,!0)},_parseOpcode:function(t){var e=[this.RSV1,this.RSV2,this.RSV3].map(function(i){return(t&i)===i}),n=this._frame=new Io;if(n.final=(t&this.FIN)===this.FIN,n.rsv1=e[0],n.rsv2=e[1],n.rsv3=e[2],n.opcode=t&this.OPCODE,this._stage=1,!this._extensions.validFrameRsv(n))return this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+(n.rsv1?1:0)+", reserved2 = "+(n.rsv2?1:0)+", reserved3 = "+(n.rsv3?1:0));if(this.OPCODE_CODES.indexOf(n.opcode)<0)return this._fail("protocol_error","Unrecognized frame opcode: "+n.opcode);if(this.MESSAGE_OPCODES.indexOf(n.opcode)<0&&!n.final)return this._fail("protocol_error","Received fragmented control frame: opcode = "+n.opcode);if(this._message&&this.OPENING_OPCODES.indexOf(n.opcode)>=0)return this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished")},_parseLength:function(t){var e=this._frame;if(e.masked=(t&this.MASK)===this.MASK,e.length=t&this.LENGTH,e.length>=0&&e.length<=125){if(this._stage=e.masked?3:4,!this._checkFrameLength())return}else this._stage=2,e.lengthBytes=e.length===126?2:8;if(this._requireMasking&&!e.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(t){var e=this._frame;if(e.length=this._readUInt(t),this._stage=e.masked?3:4,this.MESSAGE_OPCODES.indexOf(e.opcode)<0&&e.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+e.length);this._checkFrameLength()},_checkFrameLength:function(){var t=this._message?this._message.length:0;return t+this._frame.length>this._maxLength?(this._fail("too_large","WebSocket frame length too large"),!1):!0},_emitFrame:function(t){var e=this._frame,n=e.payload=q.mask(t,e.maskingKey),i=e.opcode,s,r,o,a,l;if(delete this._frame,i===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(e)}if((i===this.OPCODES.text||i===this.OPCODES.binary)&&(this._message=new No,this._message.pushFrame(e)),e.final&&this.MESSAGE_OPCODES.indexOf(i)>=0)return this._emitMessage(this._message);i===this.OPCODES.close&&(r=n.length>=2?n.readUInt16BE(0):null,o=n.length>2?this._encode(n.slice(2)):null,n.length!==0&&!(r!==null&&r>=this.MIN_RESERVED_ERROR&&r<=this.MAX_RESERVED_ERROR)&&this.ERROR_CODES.indexOf(r)<0&&(r=this.ERRORS.protocol_error),(n.length>125||n.length>2&&!o)&&(r=this.ERRORS.protocol_error),this._shutdown(r||this.DEFAULT_ERROR_CODE,o||"")),i===this.OPCODES.ping&&(this.frame(n,"pong"),this.emit("ping",new be.PingEvent(n.toString()))),i===this.OPCODES.pong&&(a=this._pingCallbacks,s=this._encode(n),l=a[s],delete a[s],l&&l(),this.emit("pong",new be.PongEvent(n.toString())))},_emitMessage:function(e){var e=this._message;e.read(),delete this._message,this._extensions.processIncomingMessage(e,function(n,i){if(n)return this._fail("extension_error",n.message);var s=i.data;if(i.opcode===this.OPCODES.text&&(s=this._encode(s)),s===null)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new be.MessageEvent(s))},this)},_encode:function(t){try{var e=t.toString("binary",0,t.length);if(!this.UTF8_MATCH.test(e))return null}catch{}return t.toString("utf8",0,t.length)},_readUInt:function(t){return t.length===2?t.readUInt16BE(0):t.readUInt32BE(0)*4294967296+t.readUInt32BE(4)}};for(vi in xo)q.prototype[vi]=xo[vi];var vi;Oo.exports=q});var Mo=b((_p,Do)=>{"use strict";var Po=Q().Buffer,uh=T("stream").Stream,Ao=T("url"),dh=T("util"),fh=le(),_h=en(),ph=an(),mh={"ws:":80,"wss:":443},Ci=function(t,e,n){this._client=t,this._http=new ph("response"),this._origin=typeof t.url=="object"?t.url:Ao.parse(t.url),this._url=typeof e=="object"?e:Ao.parse(e),this._options=n||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new _h,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var i=this._url.auth&&Po.from(this._url.auth,"utf8").toString("base64");i&&this._headers.set("Proxy-Authorization","Basic "+i)};dh.inherits(Ci,uh);var ko={setHeader:function(t,e){return this._state!==0?!1:(this._headers.set(t,e),!0)},start:function(){if(this._state!==0)return!1;this._state=1;var t=this._origin,e=t.port||mh[t.protocol],n="CONNECT "+t.hostname+":"+e+" HTTP/1.1",i=[n,this._headers.toString(),""];return this.emit("data",Po.from(i.join(`\r
`),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(t){if(!this.writable)return!1;if(this._http.parse(t),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this.statusCode===200)this.emit("connect",new fh.ConnectEvent);else{var e="Can't establish a connection to the server at "+this._origin.href;this.emit("error",new Error(e))}return this.end(),!this._paused},end:function(t){this.writable&&(t!==void 0&&this.write(t),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(Ei in ko)Ci.prototype[Ei]=ko[Ei];var Ei;Do.exports=Ci});var Uo=b((pp,Bo)=>{"use strict";var Fo=Q().Buffer,gh=T("crypto"),vh=T("url"),yh=T("util"),Eh=an(),Ch=le(),He=yi(),wh=Mo(),dt=function(t,e){this.version="hybi-"+He.VERSION,He.call(this,null,t,e),this.readyState=-1,this._key=dt.generateKey(),this._accept=He.generateAccept(this._key),this._http=new Eh("response");var n=vh.parse(this.url),i=n.auth&&Fo.from(n.auth,"utf8").toString("base64");if(this.VALID_PROTOCOLS.indexOf(n.protocol)<0)throw new Error(this.url+" is not a valid WebSocket URL");this._pathname=(n.pathname||"/")+(n.search||""),this._headers.set("Host",n.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",He.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),i&&this._headers.set("Authorization","Basic "+i)};yh.inherits(dt,He);dt.generateKey=function(){return gh.randomBytes(16).toString("base64")};var Lo={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(t,e){return new wh(this,t,e)},start:function(){return this.readyState!==-1?!1:(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(t){if(this.readyState!==3){if(this.readyState>0)return He.prototype.parse.call(this,t);this._http.parse(t),this._http.isComplete()&&(this._validateHandshake(),this.readyState!==3&&(this._open(),this.parse(this._http.body)))}},_handshakeRequest:function(){var t=this._extensions.generateOffer();t&&this._headers.set("Sec-WebSocket-Extensions",t);var e="GET "+this._pathname+" HTTP/1.1",n=[e,this._headers.toString(),""];return Fo.from(n.join(`\r
`),"utf8")},_failHandshake:function(t){t="Error during WebSocket handshake: "+t,this.readyState=3,this.emit("error",new Error(t)),this.emit("close",new Ch.CloseEvent(this.ERRORS.protocol_error,t))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(this._http.statusCode!==101)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var t=this._http.headers,e=t.upgrade||"",n=t.connection||"",i=t["sec-websocket-accept"]||"",s=t["sec-websocket-protocol"]||"";if(e==="")return this._failHandshake("'Upgrade' header is missing");if(e.toLowerCase()!=="websocket")return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(n==="")return this._failHandshake("'Connection' header is missing");if(n.toLowerCase()!=="upgrade")return this._failHandshake("'Connection' header value is not 'Upgrade'");if(i!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,s!==""){if(this._protocols.indexOf(s)<0)return this._failHandshake("Sec-WebSocket-Protocol mismatch");this.protocol=s}try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(r){return this._failHandshake(r.message)}}};for(wi in Lo)dt.prototype[wi]=Lo[wi];var wi;Bo.exports=dt});var Ti=b((mp,Wo)=>{"use strict";var cn=Q().Buffer,hn=le(),Sh=T("util"),bi=function(t,e,n){hn.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};Sh.inherits(bi,hn);var Ho={close:function(){return this.readyState===3?!1:(this.readyState=3,this.emit("close",new hn.CloseEvent(null,null)),!0)},parse:function(t){this.readyState>1||(this._reader.put(t),this._reader.eachByte(function(e){var n;switch(this._stage){case-1:this._body.push(e),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(e);break;case 1:if(this._length=(e&127)+128*this._length,this._closing&&this._length===0)return this.close();(e&128)!==128&&(this._length===0?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(e===255)this._stage=0,n=cn.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new hn.MessageEvent(n));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(e),this._buffer.length>this._maxLength)return this.close();break}},this))},frame:function(t){if(this.readyState===0)return this._queue([t]);if(this.readyState>1)return!1;typeof t!="string"&&(t=t.toString());var e=cn.byteLength(t),n=cn.allocUnsafe(e+2);return n[0]=0,n.write(t,1),n[n.length-1]=255,this._write(n),!0},_handshakeResponse:function(){var t="HTTP/1.1 101 Web Socket Protocol Handshake",e=[t,this._headers.toString(),""];return cn.from(e.join(`\r
`),"utf8")},_parseLeadingByte:function(t){(t&128)===128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(Si in Ho)bi.prototype[Si]=Ho[Si];var Si;Wo.exports=bi});var jo=b((gp,Go)=>{"use strict";var ft=Q().Buffer,bh=le(),un=Ti(),Th=T("crypto"),Ih=T("util"),qo=function(t){return parseInt((t.match(/[0-9]/g)||[]).join(""),10)},Vo=function(t){return(t.match(/ /g)||[]).length},Ni=function(t,e,n){un.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};Ih.inherits(Ni,un);var zo={BODY_SIZE:8,start:function(){return un.prototype.start.call(this)?(this._started=!0,this._sendHandshakeBody(),!0):!1},close:function(){return this.readyState===3?!1:(this.readyState===1&&this._write(ft.from([255,0])),this.readyState=3,this.emit("close",new bh.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var a=this._request.headers,t=a["sec-websocket-key1"],e=a["sec-websocket-key2"];if(!t)throw new Error("Missing required header: Sec-WebSocket-Key1");if(!e)throw new Error("Missing required header: Sec-WebSocket-Key2");var n=qo(t),i=Vo(t),s=qo(e),r=Vo(e);if(n%i!==0||s%r!==0)throw new Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[n/i,s/r];var o="HTTP/1.1 101 WebSocket Protocol Handshake",a=[o,this._headers.toString(),""];return ft.from(a.join(`\r
`),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var t=Th.createHash("md5"),e=ft.allocUnsafe(8+this.BODY_SIZE);return e.writeUInt32BE(this._keyValues[0],0),e.writeUInt32BE(this._keyValues[1],4),ft.from(this._body).copy(e,8,0,this.BODY_SIZE),t.update(e),ft.from(t.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var t=this._handshakeSignature();t&&(this._write(t),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(t){if(t!==255)return un.prototype._parseLeadingByte.call(this,t);this._closing=!0,this._length=0,this._stage=1}};for(Ii in zo)Ni.prototype[Ii]=zo[Ii];var Ii;Go.exports=Ni});var Ko=b((vp,$o)=>{"use strict";var Nh=T("util"),xh=an(),Oi=le(),Rh=Ti(),Oh=jo(),Ah=yi(),Te=function(t){Oi.call(this,null,null,t),this._http=new xh("request")};Nh.inherits(Te,Oi);var Ri={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(t){if(this._delegate)return this._delegate.parse(t);if(this._http.parse(t),!!this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var e=this;this._delegate=Te.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(n){this._delegate.on(n,function(i){e.emit(n,i)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new Oi.ConnectEvent)}},_open:function(){this.__queue.forEach(function(t){this._delegate[t[0]].apply(this._delegate,t[1])},this),this.__queue=[]}};["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(t){Ri[t]=function(){return this._delegate?this._delegate[t].apply(this._delegate,arguments):(this.__queue.push([t,arguments]),!0)}});for(xi in Ri)Te.prototype[xi]=Ri[xi];var xi;Te.isSecureRequest=function(t){if(t.connection&&t.connection.authorized!==void 0||t.socket&&t.socket.secure)return!0;var e=t.headers;return e?e.https==="on"||e["x-forwarded-ssl"]==="on"||e["x-forwarded-scheme"]==="https"||e["x-forwarded-proto"]==="https":!1};Te.determineUrl=function(t){var e=this.isSecureRequest(t)?"wss:":"ws:";return e+"//"+t.headers.host+t.url};Te.http=function(t,e){e=e||{},e.requireMasking===void 0&&(e.requireMasking=!0);var n=t.headers,i=n["sec-websocket-version"],s=n["sec-websocket-key"],r=n["sec-websocket-key1"],o=n["sec-websocket-key2"],a=this.determineUrl(t);return i||s?new Ah(t,a,e):r||o?new Oh(t,a,e):new Rh(t,a,e)};$o.exports=Te});var _t=b((yp,Qo)=>{"use strict";var Yo=le(),kh=Uo(),dn=Ko(),Ph={client:function(t,e){return e=e||{},e.masking===void 0&&(e.masking=!0),new kh(t,e)},server:function(t){return t=t||{},t.requireMasking===void 0&&(t.requireMasking=!0),new dn(t)},http:function(){return dn.http.apply(dn,arguments)},isSecureRequest:function(t){return dn.isSecureRequest(t)},isWebSocket:function(t){return Yo.isWebSocket(t)},validateOptions:function(t,e){Yo.validateOptions(t,e)}};Qo.exports=Ph});var pt=b((Ep,Xo)=>{"use strict";var Ie=function(t,e){this.type=t;for(var n in e)this[n]=e[n]};Ie.prototype.initEvent=function(t,e,n){this.type=t,this.bubbles=e,this.cancelable=n};Ie.prototype.stopPropagation=function(){};Ie.prototype.preventDefault=function(){};Ie.CAPTURING_PHASE=1;Ie.AT_TARGET=2;Ie.BUBBLING_PHASE=3;Xo.exports=Ie});var Ai=b((Cp,Zo)=>{"use strict";var Dh=pt(),Mh={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(t,e,n){this.on(t,e)},removeEventListener:function(t,e,n){this.removeListener(t,e)},dispatchEvent:function(t){t.target=t.currentTarget=this,t.eventPhase=Dh.AT_TARGET,this["on"+t.type]&&this["on"+t.type](t),this.emit(t.type,t)}};Zo.exports=Mh});var _n=b((wp,ta)=>{"use strict";var Lh=T("stream").Stream,Fh=T("util"),Bh=_t(),Jo=Ai(),fn=pt(),x=function(t){t=t||{},Bh.validateOptions(t,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var e=t.headers;if(e)for(var n in e)this._driver.setHeader(n,e[n]);var i=t.extensions;i&&[].concat(i).forEach(this._driver.addExtension,this._driver),this._ping=t.ping,this._pingId=0,this.readyState=x.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var s=this;this._driver.on("open",function(r){s._open()}),this._driver.on("message",function(r){s._receiveMessage(r.data)}),this._driver.on("close",function(r){s._beginClose(r.reason,r.code)}),this._driver.on("error",function(r){s._emitError(r.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){s.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){s._pingId+=1,s.ping(s._pingId.toString())},this._ping*1e3)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};Fh.inherits(x,Lh);x.CONNECTING=0;x.OPEN=1;x.CLOSING=2;x.CLOSED=3;x.CLOSE_TIMEOUT=3e4;var ea={write:function(t){return this.send(t)},end:function(t){t!==void 0&&this.send(t),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(t){return this.readyState>x.OPEN?!1:(t instanceof Buffer||(t=String(t)),this._driver.messages.write(t))},ping:function(t,e){return this.readyState>x.OPEN?!1:this._driver.ping(t,e)},close:function(t,e){if(t===void 0&&(t=1e3),e===void 0&&(e=""),t!==1e3&&(t<3e3||t>4999))throw new Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+t+" is neither.");if(this.readyState<x.CLOSING){var n=this;this._closeTimer=setTimeout(function(){n._beginClose("",1006)},x.CLOSE_TIMEOUT)}this.readyState!==x.CLOSED&&(this.readyState=x.CLOSING),this._driver.close(e,t)},_configureStream:function(){var t=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(e){this._stream.on(e,function(){t._finalizeClose()})},this),this._stream.on("error",function(e){t._emitError("Network error: "+t.url+": "+e.message),t._finalizeClose()})},_open:function(){if(this.readyState===x.CONNECTING){this.readyState=x.OPEN,this.protocol=this._driver.protocol||"";var t=new fn("open");t.initEvent("open",!1,!1),this.dispatchEvent(t)}},_receiveMessage:function(t){if(this.readyState>x.OPEN)return!1;this.readable&&this.emit("data",t);var e=new fn("message",{data:t});e.initEvent("message",!1,!1),this.dispatchEvent(e)},_emitError:function(t){if(!(this.readyState>=x.CLOSING)){var e=new fn("error",{message:t});e.initEvent("error",!1,!1),this.dispatchEvent(e)}},_beginClose:function(t,e){this.readyState!==x.CLOSED&&(this.readyState=x.CLOSING,this._closeParams=[t,e],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==x.CLOSED){this.readyState=x.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var t=this._closeParams?this._closeParams[0]:"",e=this._closeParams?this._closeParams[1]:1006,n=new fn("close",{code:e,reason:t});n.initEvent("close",!1,!1),this.dispatchEvent(n)}}};for(ki in ea)x.prototype[ki]=ea[ki];var ki;for(Pi in Jo)x.prototype[Pi]=Jo[Pi];var Pi;ta.exports=x});var aa=b((bp,oa)=>{"use strict";var Uh=T("util"),Hh=T("net"),na=T("tls"),ia=T("url"),Wh=_t(),sa=_n(),Sp=pt(),qh={"http:":80,"https:":443,"ws:":80,"wss:":443},ra=["https:","wss:"],pn=function(t,e,n){n=n||{},this.url=t,this._driver=Wh.client(this.url,{maxLength:n.maxLength,protocols:e}),["open","error"].forEach(function(h){this._driver.on(h,function(){u.headers=u._driver.headers,u.statusCode=u._driver.statusCode})},this);var i=n.proxy||{},s=ia.parse(i.origin||this.url),r=s.port||qh[s.protocol],o=ra.indexOf(s.protocol)>=0,a=function(){u._onConnect()},l=n.net||{},c=n.tls||{},d=i.origin?i.tls||{}:c,u=this;l.host=d.host=s.hostname,l.port=d.port=r,c.ca=c.ca||n.ca,d.servername=d.servername||s.hostname,this._stream=o?na.connect(d,a):Hh.connect(l,a),i.origin&&this._configureProxy(i,c),sa.call(this,n)};Uh.inherits(pn,sa);pn.prototype._onConnect=function(){var t=this._proxy||this._driver;t.start()};pn.prototype._configureProxy=function(t,e){var n=ia.parse(this.url),i=ra.indexOf(n.protocol)>=0,s=this,r;if(this._proxy=this._driver.proxy(t.origin),t.headers)for(r in t.headers)this._proxy.setHeader(r,t.headers[r]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(i){var o={socket:s._stream,servername:n.hostname};for(r in e)o[r]=e[r];s._stream=na.connect(o),s._configureStream()}s._driver.io.pipe(s._stream),s._stream.pipe(s._driver.io),s._driver.start()}),this._proxy.on("error",function(o){s._driver.emit("error",o)})};oa.exports=pn});var da=b((Tp,ua)=>{"use strict";var Vh=T("stream").Stream,zh=T("util"),Gh=_t(),jh=en(),We=_n(),la=Ai(),ca=pt(),mt=function(t,e,n){this.writable=!0,n=n||{},this._stream=e.socket,this._ping=n.ping||this.DEFAULT_PING,this._retry=n.retry||this.DEFAULT_RETRY;var i=Gh.isSecureRequest(t)?"https:":"http:";this.url=i+"//"+t.headers.host+t.url,this.lastEventId=t.headers["last-event-id"]||"",this.readyState=We.CONNECTING;var s=new jh,r=this;if(n.headers)for(var o in n.headers)s.set(o,n.headers[o]);if(!(!this._stream||!this._stream.writable)){process.nextTick(function(){r._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var a=`HTTP/1.1 200 OK\r
Content-Type: text/event-stream\r
Cache-Control: no-cache, no-store\r
Connection: close\r
`+s.toString()+`\r
retry: `+Math.floor(this._retry*1e3)+`\r
\r
`;this._write(a),this._stream.on("drain",function(){r.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){r.ping()},this._ping*1e3)),["error","end"].forEach(function(l){r._stream.on(l,function(){r.close()})})}};zh.inherits(mt,Vh);mt.isEventSource=function(t){if(t.method!=="GET")return!1;var e=(t.headers.accept||"").split(/\s*,\s*/);return e.indexOf("text/event-stream")>=0};var ha={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(t){if(!this.writable)return!1;try{return this._stream.write(t,"utf8")}catch{return!1}},_open:function(){if(this.readyState===We.CONNECTING){this.readyState=We.OPEN;var t=new ca("open");t.initEvent("open",!1,!1),this.dispatchEvent(t)}},write:function(t){return this.send(t)},end:function(t){t!==void 0&&this.write(t),this.close()},send:function(t,e){if(this.readyState>We.OPEN)return!1;t=String(t).replace(/(\r\n|\r|\n)/g,"$1data: "),e=e||{};var n="";return e.event&&(n+="event: "+e.event+`\r
`),e.id&&(n+="id: "+e.id+`\r
`),n+="data: "+t+`\r
\r
`,this._write(n)},ping:function(){return this._write(`:\r
\r
`)},close:function(){if(this.readyState>We.OPEN)return!1;this.readyState=We.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var t=new ca("close");return t.initEvent("close",!1,!1),this.dispatchEvent(t),!0}};for(Di in ha)mt.prototype[Di]=ha[Di];var Di;for(Mi in la)mt.prototype[Mi]=la[Mi];var Mi;ua.exports=mt});var pa=b((Ip,_a)=>{"use strict";var $h=T("util"),Li=_t(),fa=_n(),ce=function(t,e,n,i,s){s=s||{},this._stream=e,this._driver=Li.http(t,{maxLength:s.maxLength,protocols:i});var r=this;if(!(!this._stream||!this._stream.writable)){if(!this._stream.readable)return this._stream.end();var o=function(){r._stream.removeListener("data",o)};this._stream.on("data",o),fa.call(this,s),process.nextTick(function(){r._driver.start(),r._driver.io.write(n)})}};$h.inherits(ce,fa);ce.isWebSocket=function(t){return Li.isWebSocket(t)};ce.validateOptions=function(t,e){Li.validateOptions(t,e)};ce.WebSocket=ce;ce.Client=aa();ce.EventSource=da();_a.exports=ce});var kl=Wc(pa(),1);var ma=()=>{};var mn={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var f=function(t,e){if(!t)throw xe(e)},xe=function(t){return new Error("Firebase Database ("+mn.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};var ya=function(t){let e=[],n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&i+1<t.length&&(t.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++i)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},Kh=function(t){let e=[],n=0,i=0;for(;n<t.length;){let s=t[n++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){let r=t[n++];e[i++]=String.fromCharCode((s&31)<<6|r&63)}else if(s>239&&s<365){let r=t[n++],o=t[n++],a=t[n++],l=((s&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(l&1023))}else{let r=t[n++],o=t[n++];e[i++]=String.fromCharCode((s&15)<<12|(r&63)<<6|o&63)}}return e.join("")},yn={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<t.length;s+=3){let r=t[s],o=s+1<t.length,a=o?t[s+1]:0,l=s+2<t.length,c=l?t[s+2]:0,d=r>>2,u=(r&3)<<4|a>>4,h=(a&15)<<2|c>>6,_=c&63;l||(_=64,o||(h=64)),i.push(n[d],n[u],n[h],n[_])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(ya(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Kh(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();let n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<t.length;){let r=n[t.charAt(s++)],a=s<t.length?n[t.charAt(s)]:0;++s;let c=s<t.length?n[t.charAt(s)]:64;++s;let u=s<t.length?n[t.charAt(s)]:64;if(++s,r==null||a==null||c==null||u==null)throw new Bi;let h=r<<2|a>>4;if(i.push(h),c!==64){let _=a<<4&240|c>>2;if(i.push(_),u!==64){let p=c<<6&192|u;i.push(p)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},Bi=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Hi=function(t){let e=ya(t);return yn.encodeByteArray(e,!0)},vt=function(t){return Hi(t).replace(/\./g,"")},gn=function(t){try{return yn.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Ea(t){return Ca(void 0,t)}function Ca(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:let n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(let n in e)!e.hasOwnProperty(n)||!Yh(n)||(t[n]=Ca(t[n],e[n]));return t}function Yh(t){return t!=="__proto__"}function Qh(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Xh=()=>Qh().__FIREBASE_DEFAULTS__,Zh=()=>{if(typeof process>"u"||typeof process.env>"u")return;let t=process.env.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Jh=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=t&&gn(t[1]);return e&&JSON.parse(e)},wa=()=>{try{return ma()||Xh()||Zh()||Jh()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},eu=t=>{var e,n;return(n=(e=wa())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},Sa=t=>{let e=eu(t);if(!e)return;let n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let i=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),i]:[e.substring(0,n),i]},Wi=()=>{var t;return(t=wa())===null||t===void 0?void 0:t.config};var se=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,i)=>{n?this.reject(n):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,i))}}};function En(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}function ba(t){return D(this,null,function*(){return(yield fetch(t,{credentials:"include"})).ok})}function Ta(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n={alg:"none",type:"JWT"},i=e||"demo-project",s=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t);return[vt(JSON.stringify(n)),vt(JSON.stringify(o)),""].join(".")}var gt={};function tu(){let t={prod:[],emulator:[]};for(let e of Object.keys(gt))gt[e]?t.emulator.push(e):t.prod.push(e);return t}function nu(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}var ga=!1;function Ia(t,e){if(typeof window>"u"||typeof document>"u"||!En(window.location.host)||gt[t]===e||gt[t]||ga)return;gt[t]=e;function n(h){return`__firebase__banner__${h}`}let i="__firebase__banner",r=tu().prod.length>0;function o(){let h=document.getElementById(i);h&&h.remove()}function a(h){h.style.display="flex",h.style.background="#7faaf0",h.style.position="fixed",h.style.bottom="5px",h.style.left="5px",h.style.padding=".5em",h.style.borderRadius="5px",h.style.alignItems="center"}function l(h,_){h.setAttribute("width","24"),h.setAttribute("id",_),h.setAttribute("height","24"),h.setAttribute("viewBox","0 0 24 24"),h.setAttribute("fill","none"),h.style.marginLeft="-6px"}function c(){let h=document.createElement("span");return h.style.cursor="pointer",h.style.marginLeft="16px",h.style.fontSize="24px",h.innerHTML=" &times;",h.onclick=()=>{ga=!0,o()},h}function d(h,_){h.setAttribute("id",_),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline"}function u(){let h=nu(i),_=n("text"),p=document.getElementById(_)||document.createElement("span"),C=n("learnmore"),k=document.getElementById(C)||document.createElement("a"),ne=n("preprendIcon"),ie=document.getElementById(ne)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(h.created){let ve=h.element;a(ve),d(k,C);let ii=c();l(ie,ne),ve.append(ie,p,k,ii),document.body.appendChild(ve)}r?(p.innerText="Preview backend disconnected.",ie.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(ie.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,p.innerText="Preview backend running in this workspace."),p.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",u):u()}function iu(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function qi(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(iu())}function Rp(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Op(){let t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Na(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function X(){return mn.NODE_CLIENT===!0||mn.NODE_ADMIN===!0}function xa(){try{return typeof indexedDB=="object"}catch{return!1}}function Ra(){return new Promise((t,e)=>{try{let n=!0,i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var r;e(((r=s.error)===null||r===void 0?void 0:r.message)||"")}}catch(n){e(n)}})}var su="FirebaseError",Ne=class t extends Error{constructor(e,n,i){super(n),this.code=e,this.customData=i,this.name=su,Object.setPrototypeOf(this,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,yt.prototype.create)}},yt=class{constructor(e,n,i){this.service=e,this.serviceName=n,this.errors=i}create(e,...n){let i=n[0]||{},s=`${this.service}/${e}`,r=this.errors[e],o=r?ru(r,i):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Ne(s,a,i)}};function ru(t,e){return t.replace(ou,(n,i)=>{let s=e[i];return s!=null?String(s):`<${i}?>`})}var ou=/\{\$([^}]+)}/g;function qe(t){return JSON.parse(t)}function A(t){return JSON.stringify(t)}var Oa=function(t){let e={},n={},i={},s="";try{let r=t.split(".");e=qe(gn(r[0])||""),n=qe(gn(r[1])||""),s=r[2],i=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:i,signature:s}};var Aa=function(t){let e=Oa(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},ka=function(t){let e=Oa(t).claims;return typeof e=="object"&&e.admin===!0};function j(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Re(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function Vi(t){for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Et(t,e,n){let i={};for(let s in t)Object.prototype.hasOwnProperty.call(t,s)&&(i[s]=e.call(n,t[s],s,t));return i}function Ve(t,e){if(t===e)return!0;let n=Object.keys(t),i=Object.keys(e);for(let s of n){if(!i.includes(s))return!1;let r=t[s],o=e[s];if(va(r)&&va(o)){if(!Ve(r,o))return!1}else if(r!==o)return!1}for(let s of i)if(!n.includes(s))return!1;return!0}function va(t){return t!==null&&typeof t=="object"}function Pa(t){let e=[];for(let[n,i]of Object.entries(t))Array.isArray(i)?i.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}var vn=class{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);let i=this.W_;if(typeof e=="string")for(let u=0;u<16;u++)i[u]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let u=0;u<16;u++)i[u]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let u=16;u<80;u++){let h=i[u-3]^i[u-8]^i[u-14]^i[u-16];i[u]=(h<<1|h>>>31)&4294967295}let s=this.chain_[0],r=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],c,d;for(let u=0;u<80;u++){u<40?u<20?(c=a^r&(o^a),d=1518500249):(c=r^o^a,d=1859775393):u<60?(c=r&o|a&(r|o),d=2400959708):(c=r^o^a,d=3395469782);let h=(s<<5|s>>>27)+c+l+d+i[u]&4294967295;l=a,a=o,o=(r<<30|r>>>2)&4294967295,r=s,s=h}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);let i=n-this.blockSize,s=0,r=this.buf_,o=this.inbuf_;for(;s<n;){if(o===0)for(;s<=i;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<n;)if(r[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}else for(;s<n;)if(r[o]=e[s],++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){let e=[],n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=n&255,n/=256;this.compress_(this.buf_);let i=0;for(let s=0;s<5;s++)for(let r=24;r>=0;r-=8)e[i]=this.chain_[s]>>r&255,++i;return e}};function Ap(t,e){let n=new Ui(t,e);return n.subscribe.bind(n)}var Ui=class{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,i){let s;if(e===void 0&&n===void 0&&i===void 0)throw new Error("Missing Observer.");au(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:i},s.next===void 0&&(s.next=Fi),s.error===void 0&&(s.error=Fi),s.complete===void 0&&(s.complete=Fi);let r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function au(t,e){if(typeof t!="object"||t===null)return!1;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Fi(){}function Ct(t,e){return`${t} failed: ${e} argument `}var Da=function(t){let e=[],n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);if(s>=55296&&s<=56319){let r=s-55296;i++,f(i<t.length,"Surrogate pair missing trail surrogate.");let o=t.charCodeAt(i)-56320;s=65536+(r<<10)+o}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},wt=function(t){let e=0;for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,n++):e+=3}return e};var kp=14400*1e3;function he(t){return t&&t._delegate?t._delegate:t}mn.NODE_CLIENT=!0;var lu=[],I=(function(t){return t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT",t})(I||{}),cu={debug:I.DEBUG,verbose:I.VERBOSE,info:I.INFO,warn:I.WARN,error:I.ERROR,silent:I.SILENT},hu=I.INFO,uu={[I.DEBUG]:"log",[I.VERBOSE]:"log",[I.INFO]:"info",[I.WARN]:"warn",[I.ERROR]:"error"},du=(t,e,...n)=>{if(e<t.logLevel)return;let i=new Date().toISOString(),s=uu[e];if(s)console[s](`[${i}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},ze=class{constructor(e){this.name=e,this._logLevel=hu,this._logHandler=du,this._userLogHandler=null,lu.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in I))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?cu[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,I.DEBUG,...e),this._logHandler(this,I.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,I.VERBOSE,...e),this._logHandler(this,I.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,I.INFO,...e),this._logHandler(this,I.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,I.WARN,...e),this._logHandler(this,I.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,I.ERROR,...e),this._logHandler(this,I.ERROR,...e)}};var re=class{constructor(e,n,i){this.name=e,this.instanceFactory=n,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Oe="[DEFAULT]";var Cn=class{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){let i=new se;if(this.instancesDeferred.set(n,i),this.isInitialized(n)||this.shouldAutoInitialize())try{let s=this.getOrInitializeService({instanceIdentifier:n});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;let i=this.normalizeInstanceIdentifier(e?.identifier),s=(n=e?.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(_u(e))try{this.getOrInitializeService({instanceIdentifier:Oe})}catch{}for(let[n,i]of this.instancesDeferred.entries()){let s=this.normalizeInstanceIdentifier(n);try{let r=this.getOrInitializeService({instanceIdentifier:s});i.resolve(r)}catch{}}}}clearInstance(e=Oe){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return D(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Oe){return this.instances.has(e)}getOptions(e=Oe){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:n={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let s=this.getOrInitializeService({instanceIdentifier:i,options:n});for(let[r,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(r);i===a&&o.resolve(s)}return s}onInit(e,n){var i;let s=this.normalizeInstanceIdentifier(n),r=(i=this.onInitCallbacks.get(s))!==null&&i!==void 0?i:new Set;r.add(e),this.onInitCallbacks.set(s,r);let o=this.instances.get(s);return o&&e(o,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,n){let i=this.onInitCallbacks.get(n);if(i)for(let s of i)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:fu(e),options:n}),this.instances.set(e,i),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Oe){return this.component?this.component.multipleInstances?e:Oe:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function fu(t){return t===Oe?void 0:t}function _u(t){return t.instantiationMode==="EAGER"}var St=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let n=new Cn(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}};var pu=(t,e)=>e.some(n=>t instanceof n),Ma,La;function mu(){return Ma||(Ma=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function gu(){return La||(La=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Fa=new WeakMap,Gi=new WeakMap,Ba=new WeakMap,zi=new WeakMap,$i=new WeakMap;function vu(t){let e=new Promise((n,i)=>{let s=()=>{t.removeEventListener("success",r),t.removeEventListener("error",o)},r=()=>{n(Z(t.result)),s()},o=()=>{i(t.error),s()};t.addEventListener("success",r),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&Fa.set(n,t)}).catch(()=>{}),$i.set(e,t),e}function yu(t){if(Gi.has(t))return;let e=new Promise((n,i)=>{let s=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",o),t.removeEventListener("abort",o)},r=()=>{n(),s()},o=()=>{i(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",r),t.addEventListener("error",o),t.addEventListener("abort",o)});Gi.set(t,e)}var ji={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Gi.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Ba.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Z(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Ua(t){ji=t(ji)}function Eu(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){let i=t.call(wn(this),e,...n);return Ba.set(i,e.sort?e.sort():[e]),Z(i)}:gu().includes(t)?function(...e){return t.apply(wn(this),e),Z(Fa.get(this))}:function(...e){return Z(t.apply(wn(this),e))}}function Cu(t){return typeof t=="function"?Eu(t):(t instanceof IDBTransaction&&yu(t),pu(t,mu())?new Proxy(t,ji):t)}function Z(t){if(t instanceof IDBRequest)return vu(t);if(zi.has(t))return zi.get(t);let e=Cu(t);return e!==t&&(zi.set(t,e),$i.set(e,t)),e}var wn=t=>$i.get(t);function Wa(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){let o=indexedDB.open(t,e),a=Z(o);return i&&o.addEventListener("upgradeneeded",l=>{i(Z(o.result),l.oldVersion,l.newVersion,Z(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{r&&l.addEventListener("close",()=>r()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}var wu=["get","getKey","getAll","getAllKeys","count"],Su=["put","add","delete","clear"],Ki=new Map;function Ha(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Ki.get(e))return Ki.get(e);let n=e.replace(/FromIndex$/,""),i=e!==n,s=Su.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(s||wu.includes(n)))return;let r=function(o,...a){return D(this,null,function*(){let l=this.transaction(o,s?"readwrite":"readonly"),c=l.store;return i&&(c=c.index(a.shift())),(yield Promise.all([c[n](...a),s&&l.done]))[0]})};return Ki.set(e,r),r}Ua(t=>Pr(kr({},t),{get:(e,n,i)=>Ha(e,n)||t.get(e,n,i),has:(e,n)=>!!Ha(e,n)||t.has(e,n)}));var Qi=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(bu(n)){let i=n.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(n=>n).join(" ")}};function bu(t){let e=t.getComponent();return e?.type==="VERSION"}var Xi="@firebase/app",qa="0.13.2";var oe=new ze("@firebase/app"),Tu="@firebase/app-compat",Iu="@firebase/analytics-compat",Nu="@firebase/analytics",xu="@firebase/app-check-compat",Ru="@firebase/app-check",Ou="@firebase/auth",Au="@firebase/auth-compat",ku="@firebase/database",Pu="@firebase/data-connect",Du="@firebase/database-compat",Mu="@firebase/functions",Lu="@firebase/functions-compat",Fu="@firebase/installations",Bu="@firebase/installations-compat",Uu="@firebase/messaging",Hu="@firebase/messaging-compat",Wu="@firebase/performance",qu="@firebase/performance-compat",Vu="@firebase/remote-config",zu="@firebase/remote-config-compat",Gu="@firebase/storage",ju="@firebase/storage-compat",$u="@firebase/firestore",Ku="@firebase/ai",Yu="@firebase/firestore-compat",Qu="firebase",Xu="11.10.0";var Zi="[DEFAULT]",Zu={[Xi]:"fire-core",[Tu]:"fire-core-compat",[Nu]:"fire-analytics",[Iu]:"fire-analytics-compat",[Ru]:"fire-app-check",[xu]:"fire-app-check-compat",[Ou]:"fire-auth",[Au]:"fire-auth-compat",[ku]:"fire-rtdb",[Pu]:"fire-data-connect",[Du]:"fire-rtdb-compat",[Mu]:"fire-fn",[Lu]:"fire-fn-compat",[Fu]:"fire-iid",[Bu]:"fire-iid-compat",[Uu]:"fire-fcm",[Hu]:"fire-fcm-compat",[Wu]:"fire-perf",[qu]:"fire-perf-compat",[Vu]:"fire-rc",[zu]:"fire-rc-compat",[Gu]:"fire-gcs",[ju]:"fire-gcs-compat",[$u]:"fire-fst",[Yu]:"fire-fst-compat",[Ku]:"fire-vertex","fire-js":"fire-js",[Qu]:"fire-js-all"};var bt=new Map,Ju=new Map,Ji=new Map;function Va(t,e){try{t.container.addComponent(e)}catch(n){oe.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Tt(t){let e=t.name;if(Ji.has(e))return oe.debug(`There were multiple attempts to register component ${e}.`),!1;Ji.set(e,t);for(let n of bt.values())Va(n,t);for(let n of Ju.values())Va(n,t);return!0}function $a(t,e){let n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Ka(t){return t==null?!1:t.settings!==void 0}var ed={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ue=new yt("app","Firebase",ed);var es=class{constructor(e,n,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new re("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ue.create("app-deleted",{appName:this._name})}};var Ya=Xu;function is(t,e={}){let n=t;typeof e!="object"&&(e={name:e});let i=Object.assign({name:Zi,automaticDataCollectionEnabled:!0},e),s=i.name;if(typeof s!="string"||!s)throw ue.create("bad-app-name",{appName:String(s)});if(n||(n=Wi()),!n)throw ue.create("no-options");let r=bt.get(s);if(r){if(Ve(n,r.options)&&Ve(i,r.config))return r;throw ue.create("duplicate-app",{appName:s})}let o=new St(s);for(let l of Ji.values())o.addComponent(l);let a=new es(n,i,o);return bt.set(s,a),a}function Sn(t=Zi){let e=bt.get(t);if(!e&&t===Zi&&Wi())return is();if(!e)throw ue.create("no-app",{appName:t});return e}function Qa(){return Array.from(bt.values())}function de(t,e,n){var i;let s=(i=Zu[t])!==null&&i!==void 0?i:t;n&&(s+=`-${n}`);let r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){let a=[`Unable to register library "${s}" with version "${e}":`];r&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),oe.warn(a.join(" "));return}Tt(new re(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}var td="firebase-heartbeat-database",nd=1,It="firebase-heartbeat-store",Yi=null;function Xa(){return Yi||(Yi=Wa(td,nd,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(It)}catch(n){console.warn(n)}}}}).catch(t=>{throw ue.create("idb-open",{originalErrorMessage:t.message})})),Yi}function id(t){return D(this,null,function*(){try{let n=(yield Xa()).transaction(It),i=yield n.objectStore(It).get(Za(t));return yield n.done,i}catch(e){if(e instanceof Ne)oe.warn(e.message);else{let n=ue.create("idb-get",{originalErrorMessage:e?.message});oe.warn(n.message)}}})}function za(t,e){return D(this,null,function*(){try{let i=(yield Xa()).transaction(It,"readwrite");yield i.objectStore(It).put(e,Za(t)),yield i.done}catch(n){if(n instanceof Ne)oe.warn(n.message);else{let i=ue.create("idb-set",{originalErrorMessage:n?.message});oe.warn(i.message)}}})}function Za(t){return`${t.name}!${t.options.appId}`}var sd=1024,rd=30,ts=class{constructor(e){this.container=e,this._heartbeatsCache=null;let n=this.container.getProvider("app").getImmediate();this._storage=new ns(n),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}triggerHeartbeat(){return D(this,null,function*(){var e,n;try{let s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Ga();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(o=>o.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:s}),this._heartbeatsCache.heartbeats.length>rd){let o=ad(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){oe.warn(i)}})}getHeartbeatsHeader(){return D(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let n=Ga(),{heartbeatsToSend:i,unsentEntries:s}=od(this._heartbeatsCache.heartbeats),r=vt(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(n){return oe.warn(n),""}})}};function Ga(){return new Date().toISOString().substring(0,10)}function od(t,e=sd){let n=[],i=t.slice();for(let s of t){let r=n.find(o=>o.agent===s.agent);if(r){if(r.dates.push(s.date),ja(n)>e){r.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),ja(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}var ns=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return D(this,null,function*(){return xa()?Ra().then(()=>!0).catch(()=>!1):!1})}read(){return D(this,null,function*(){if(yield this._canUseIndexedDBPromise){let n=yield id(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return D(this,null,function*(){var n;if(yield this._canUseIndexedDBPromise){let s=yield this.read();return za(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return D(this,null,function*(){var n;if(yield this._canUseIndexedDBPromise){let s=yield this.read();return za(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return})}};function ja(t){return vt(JSON.stringify({version:2,heartbeats:t})).length}function ad(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let i=1;i<t.length;i++)t[i].date<n&&(n=t[i].date,e=i);return e}function ld(t){Tt(new re("platform-logger",e=>new Qi(e),"PRIVATE")),Tt(new re("heartbeat",e=>new ts(e),"PRIVATE")),de(Xi,qa,t),de(Xi,qa,"esm2017"),de("fire-js","")}ld("");var Tn="5",Pl="v",Dl="s",Ml="r",Ll="f",Fl=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Bl="ls",Ul="p",us="ac",Hl="websocket",Wl="long_polling";var ds=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),A(n))}get(e){let n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:qe(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var fs=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return j(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var ql=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){let e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new ds(e)}}catch{}return new fs},ke=ql("localStorage"),_s=ql("sessionStorage");var $e=new ze("@firebase/database"),cd=(function(){let t=1;return function(){return t++}})(),Vl=function(t){let e=Da(t),n=new vn;n.update(e);let i=n.digest();return yn.encodeByteArray(i)},$t=function(...t){let e="";for(let n=0;n<t.length;n++){let i=t[n];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=$t.apply(null,i):typeof i=="object"?e+=A(i):e+=i,e+=" "}return e},Pe=null,Ja=!0,hd=function(t,e){f(!e||t===!0||t===!1,"Can't turn on custom loggers persistently."),t===!0?($e.logLevel=I.VERBOSE,Pe=$e.log.bind($e),e&&_s.set("logging_enabled",!0)):typeof t=="function"?Pe=t:(Pe=null,_s.remove("logging_enabled"))},M=function(...t){if(Ja===!0&&(Ja=!1,Pe===null&&_s.get("logging_enabled")===!0&&hd(!0)),Pe){let e=$t.apply(null,t);Pe(e)}},Kt=function(t){return function(...e){M(t,...e)}},ps=function(...t){let e="FIREBASE INTERNAL ERROR: "+$t(...t);$e.error(e)},ae=function(...t){let e=`FIREBASE FATAL ERROR: ${$t(...t)}`;throw $e.error(e),new Error(e)},H=function(...t){let e="FIREBASE WARNING: "+$t(...t);$e.warn(e)},ud=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&H("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},or=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},dd=function(t){if(X()||document.readyState==="complete")t();else{let e=!1,n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Ye="[MIN_NAME]",De="[MAX_NAME]",Le=function(t,e){if(t===e)return 0;if(t===Ye||e===De)return-1;if(e===Ye||t===De)return 1;{let n=el(t),i=el(e);return n!==null?i!==null?n-i===0?t.length-e.length:n-i:-1:i!==null?1:t<e?-1:1}},fd=function(t,e){return t===e?0:t<e?-1:1},Nt=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+A(e))},ar=function(t){if(typeof t!="object"||t===null)return A(t);let e=[];for(let i in t)e.push(i);e.sort();let n="{";for(let i=0;i<e.length;i++)i!==0&&(n+=","),n+=A(e[i]),n+=":",n+=ar(t[e[i]]);return n+="}",n},zl=function(t,e){let n=t.length;if(n<=e)return[t];let i=[];for(let s=0;s<n;s+=e)s+e>n?i.push(t.substring(s,n)):i.push(t.substring(s,s+e));return i};function L(t,e){for(let n in t)t.hasOwnProperty(n)&&e(n,t[n])}var Gl=function(t){f(!or(t),"Invalid JSON number");let e=11,n=52,i=(1<<e-1)-1,s,r,o,a,l;t===0?(r=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),i),r=a+i,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(r=0,o=Math.round(t/Math.pow(2,1-i-n))));let c=[];for(l=n;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(s?1:0),c.reverse();let d=c.join(""),u="";for(l=0;l<64;l+=8){let h=parseInt(d.substr(l,8),2).toString(16);h.length===1&&(h="0"+h),u=u+h}return u.toLowerCase()},_d=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},pd=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function md(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");let i=new Error(t+" at "+e._path.toString()+": "+n);return i.code=t.toUpperCase(),i}var gd=new RegExp("^-?(0*)\\d{1,10}$"),vd=-2147483648,yd=2147483647,el=function(t){if(gd.test(t)){let e=Number(t);if(e>=vd&&e<=yd)return e}return null},st=function(t){try{t()}catch(e){setTimeout(()=>{let n=e.stack||"";throw H("Exception was thrown by user callback.",n),e},Math.floor(0))}},Ed=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},kt=function(t,e){let n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};var In=class{constructor(e,n,i,s,r=!1,o="",a=!1,l=!1,c=null){this.secure=n,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ke.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ke.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}};function Cd(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function jl(t,e,n){f(typeof e=="string","typeof type must == string"),f(typeof n=="object","typeof params must == object");let i;if(e===Hl)i=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Wl)i=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Cd(t)&&(n.ns=t.namespace);let s=[];return L(n,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}var ms=class{constructor(){this.counters_={}}incrementCounter(e,n=1){j(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return Ea(this.counters_)}};var ss={},rs={};function lr(t){let e=t.toString();return ss[e]||(ss[e]=new ms),ss[e]}function wd(t,e){let n=t.toString();return rs[n]||(rs[n]=e()),rs[n]}var cr="";function Sd(t){cr=t}var bd=16384,Td=45e3,Ft=null;typeof MozWebSocket<"u"?Ft=MozWebSocket:typeof WebSocket<"u"&&(Ft=WebSocket);function Id(t){Ft=t}var xt=(()=>{class t{constructor(n,i,s,r,o,a,l){this.connId=n,this.applicationId=s,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Kt(this.connId),this.stats_=lr(i),this.connURL=t.connectionURL_(i,a,l,r,s),this.nodeAdmin=i.nodeAdmin}static connectionURL_(n,i,s,r,o){let a={};return a[Pl]=Tn,!X()&&typeof location<"u"&&location.hostname&&Fl.test(location.hostname)&&(a[Ml]=Ll),i&&(a[Dl]=i),s&&(a[Bl]=s),r&&(a[us]=r),o&&(a[Ul]=o),jl(n,Hl,a)}open(n,i){this.onDisconnect=i,this.onMessage=n,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ke.set("previous_websocket_failure",!0);try{let s;if(X()){let r=this.nodeAdmin?"AdminNode":"Node";s={headers:{"User-Agent":`Firebase/${Tn}/${cr}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(s.proxy={origin:a})}this.mySock=new Ft(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){t.forceDisallow_=!0}static isAvailable(){let n=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(i);s&&s.length>1&&parseFloat(s[1])<4.4&&(n=!0)}return!n&&Ft!==null&&!t.forceDisallow_}static previouslyFailed(){return ke.isInMemoryStorage||ke.get("previous_websocket_failure")===!0}markConnectionHealthy(){ke.remove("previous_websocket_failure")}appendFrame_(n){if(this.frames.push(n),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let s=qe(i);this.onMessage(s)}}handleNewFrameCount_(n){this.totalFrames=n,this.frames=[]}extractFrameCount_(n){if(f(this.frames===null,"We already have a frame buffer"),n.length<=6){let i=Number(n);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),n}handleIncomingFrame(n){if(this.mySock===null)return;let i=n.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let s=this.extractFrameCount_(i);s!==null&&this.appendFrame_(s)}}send(n){this.resetKeepAlive();let i=A(n);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let s=zl(i,bd);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Td))}sendString_(n){try{this.mySock.send(n)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t})(),tl="@firebase/database",nl="1.0.20";var gs=class{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,Ka(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n?.getImmediate({optional:!0}),this.appCheck||n?.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)===null||n===void 0||n.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){H(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}};var vs=class{constructor(e,n,i){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(M("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',H(e)}},Pt=(()=>{class t{constructor(n){this.accessToken=n}getToken(n){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(n){n(this.accessToken)}removeTokenChangeListener(n){}notifyForInvalidToken(){}}t.OWNER="owner";return t})(),ys=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&st(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var il="start",Nd="close",xd="pLPCommand",Rd="pRTLPCB",$l="id",Kl="pw",Yl="ser",Od="cb",Ad="seg",kd="ts",Pd="d",Dd="dframe",Ql=1870,Xl=30,Md=Ql-Xl,Ld=25e3,Fd=3e4,Es=class t{constructor(e,n,i,s,r,o,a){this.connId=e,this.repoInfo=n,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Kt(e),this.stats_=lr(n),this.urlFn=l=>(this.appCheckToken&&(l[us]=this.appCheckToken),jl(n,Wl,l))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new ys(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Fd)),dd(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Cs((...r)=>{let[o,a,l,c,d]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===il)this.id=a,this.password=l;else if(o===Nd)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[il]="t",i[Yl]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[Od]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Pl]=Tn,this.transportSessionId&&(i[Dl]=this.transportSessionId),this.lastSessionId&&(i[Bl]=this.lastSessionId),this.applicationId&&(i[Ul]=this.applicationId),this.appCheckToken&&(i[us]=this.appCheckToken),typeof location<"u"&&location.hostname&&Fl.test(location.hostname)&&(i[Ml]=Ll);let s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){t.forceAllow_=!0}static forceDisallow(){t.forceDisallow_=!0}static isAvailable(){return X()?!1:t.forceAllow_?!0:!t.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!_d()&&!pd()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let n=A(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);let i=Hi(n),s=zl(i,Md);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,n){if(X())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[Dd]="t",i[$l]=e,i[Kl]=n,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let n=A(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}},Cs=class t{constructor(e,n,i,s){if(this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,X())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=cd(),window[xd+this.uniqueCallbackIdentifier]=e,window[Rd+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";</script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){M("frame writing exception"),a.stack&&M(a.stack),M(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||M("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[$l]=this.myID,e[Kl]=this.myPW,e[Yl]=this.currentSerial;let n=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Xl+i.length<=Ql;){let o=this.pendingSegs.shift();i=i+"&"+Ad+s+"="+o.seg+"&"+kd+s+"="+o.ts+"&"+Pd+s+"="+o.d,s++}return n=n+i,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,i){this.pendingSegs.push({seg:e,ts:n,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);let i=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(i,Math.floor(Ld)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,n){X()?this.doNodeLongPoll(e,n):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),n())},i.onerror=()=>{M("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var Bd=(()=>{class t{static get ALL_TRANSPORTS(){return[Es,xt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(n){this.initTransports_(n)}initTransports_(n){let i=xt&&xt.isAvailable(),s=i&&!xt.previouslyFailed();if(n.webSocketOnly&&(i||H("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[xt];else{let r=this.transports_=[];for(let o of t.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);t.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}t.globalTransportInitialized_=!1;return t})(),Ud=6e4,Hd=5e3,Wd=10*1024,qd=100*1024,os="t",sl="d",Vd="s",rl="r",zd="e",ol="o",al="a",ll="n",cl="p",Gd="h",ws=class{constructor(e,n,i,s,r,o,a,l,c,d){this.id=e,this.repoInfo_=n,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Kt("c:"+this.id+":"),this.transportManager_=new Bd(n),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let n=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,i)},Math.floor(0));let s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=kt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>qd?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Wd?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){let n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(os in e){let n=e[os];n===al?this.upgradeIfSecondaryHealthy_():n===rl?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===ol&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let n=Nt("t",e),i=Nt("d",e);if(n==="c")this.onSecondaryControl_(i);else if(n==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:cl,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:al,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:ll,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let n=Nt("t",e),i=Nt("d",e);n==="c"?this.onControl_(i):n==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let n=Nt(os,e);if(sl in e){let i=e[sl];if(n===Gd){let s=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===ll){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===Vd?this.onConnectionShutdown_(i):n===rl?this.onReset_(i):n===zd?ps("Server Error: "+i):n===ol?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ps("Unknown control packet command: "+n)}}onHandshake_(e){let n=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),Tn!==i&&H("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let n=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,i),kt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Ud))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):kt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Hd))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:cl,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ke.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var Nn=class{put(e,n,i,s){}merge(e,n,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,i){}onDisconnectMerge(e,n,i){}onDisconnectCancel(e,n){}reportStats(e){}};var xn=class{constructor(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,n)}}on(e,n,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:i});let s=this.getInitialEvent(e);s&&n.apply(i,s)}off(e,n,i){this.validateEventType_(e);let s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===n&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){f(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}};var Rn=class t extends xn{static getInstance(){return new t}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!qi()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return f(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var hl=32,ul=768,S=class{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}};function w(){return new S("")}function v(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function me(t){return t.pieces_.length-t.pieceNum_}function N(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new S(t.pieces_,e)}function hr(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function jd(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Bt(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Zl(t){if(t.pieceNum_>=t.pieces_.length)return null;let e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new S(e,0)}function R(t,e){let n=[];for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);if(e instanceof S)for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);else{let i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&n.push(i[s])}return new S(n,0)}function E(t){return t.pieceNum_>=t.pieces_.length}function U(t,e){let n=v(t),i=v(e);if(n===null)return e;if(n===i)return U(N(t),N(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function $d(t,e){let n=Bt(t,0),i=Bt(e,0);for(let s=0;s<n.length&&s<i.length;s++){let r=Le(n[s],i[s]);if(r!==0)return r}return n.length===i.length?0:n.length<i.length?-1:1}function ur(t,e){if(me(t)!==me(e))return!1;for(let n=t.pieceNum_,i=e.pieceNum_;n<=t.pieces_.length;n++,i++)if(t.pieces_[n]!==e.pieces_[i])return!1;return!0}function V(t,e){let n=t.pieceNum_,i=e.pieceNum_;if(me(t)>me(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[i])return!1;++n,++i}return!0}var Ss=class{constructor(e,n){this.errorPrefix_=n,this.parts_=Bt(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=wt(this.parts_[i]);Jl(this)}};function Kd(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=wt(e),Jl(t)}function Yd(t){let e=t.parts_.pop();t.byteLength_-=wt(e),t.parts_.length>0&&(t.byteLength_-=1)}function Jl(t){if(t.byteLength_>ul)throw new Error(t.errorPrefix_+"has a key path longer than "+ul+" bytes ("+t.byteLength_+").");if(t.parts_.length>hl)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+hl+") or object contains a cycle "+Ae(t))}function Ae(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}var bs=class t extends xn{static getInstance(){return new t}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return f(e==="visible","Unknown event type: "+e),[this.visible_]}};var Rt=1e3,Qd=300*1e3,dl=30*1e3,Xd=1.3,Zd=3e4,Jd="server_kill",fl=3,dr=(()=>{class t extends Nn{constructor(n,i,s,r,o,a,l,c){if(super(),this.repoInfo_=n,this.applicationId_=i,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=t.nextPersistentConnectionId_++,this.log_=Kt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Rt,this.maxReconnectDelay_=Qd,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!X())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");bs.getInstance().on("visible",this.onVisible_,this),n.host.indexOf("fblocal")===-1&&Rn.getInstance().on("online",this.onOnline_,this)}sendRequest(n,i,s){let r=++this.requestNumber_,o={r,a:n,b:i};this.log_(A(o)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[r]=s)}get(n){this.initConnection_();let i=new se,r={action:"g",request:{p:n._path.toString(),q:n._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?i.resolve(l):i.reject(l)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(n,i,s,r){this.initConnection_();let o=n._queryIdentifier,a=n._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),f(n._queryParams.isDefault()||!n._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:r,hashFn:i,query:n,tag:s};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(n){let i=this.outstandingGets_[n];this.sendRequest("g",i.request,s=>{delete this.outstandingGets_[n],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(s)})}sendListen_(n){let i=n.query,s=i._path.toString(),r=i._queryIdentifier;this.log_("Listen on "+s+" for "+r);let o={p:s},a="q";n.tag&&(o.q=i._queryObject,o.t=n.tag),o.h=n.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,d=l.s;t.warnOnListenWarnings_(c,i),(this.listens.get(s)&&this.listens.get(s).get(r))===n&&(this.log_("listen response",l),d!=="ok"&&this.removeListen_(s,r),n.onComplete&&n.onComplete(d,c))})}static warnOnListenWarnings_(n,i){if(n&&typeof n=="object"&&j(n,"w")){let s=Re(n,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){let r='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();H(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(n){this.authToken_=n,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(n)}reduceReconnectDelayIfAdminCredential_(n){(n&&n.length===40||ka(n))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=dl)}refreshAppCheckToken(n){this.appCheckToken_=n,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let n=this.authToken_,i=Aa(n)?"auth":"gauth",s={cred:n};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(i,s,r=>{let o=r.s,a=r.d||"error";this.authToken_===n&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},n=>{let i=n.s,s=n.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,s)})}unlisten(n,i){let s=n._path.toString(),r=n._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),f(n._queryParams.isDefault()||!n._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,n._queryObject,i)}sendUnlisten_(n,i,s,r){this.log_("Unlisten on "+n+" for "+i);let o={p:n},a="n";r&&(o.q=s,o.t=r),this.sendRequest(a,o)}onDisconnectPut(n,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",n,i,s):this.onDisconnectRequestQueue_.push({pathString:n,action:"o",data:i,onComplete:s})}onDisconnectMerge(n,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",n,i,s):this.onDisconnectRequestQueue_.push({pathString:n,action:"om",data:i,onComplete:s})}onDisconnectCancel(n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",n,null,i):this.onDisconnectRequestQueue_.push({pathString:n,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(n,i,s,r){let o={p:i,d:s};this.log_("onDisconnect "+n,o),this.sendRequest(n,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(n,i,s,r){this.putInternal("p",n,i,s,r)}merge(n,i,s,r){this.putInternal("m",n,i,s,r)}putInternal(n,i,s,r,o){this.initConnection_();let a={p:i,d:s};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:n,request:a,onComplete:r}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+i)}sendPut_(n){let i=this.outstandingPuts_[n].action,s=this.outstandingPuts_[n].request,r=this.outstandingPuts_[n].onComplete;this.outstandingPuts_[n].queued=this.connected_,this.sendRequest(i,s,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[n],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(n){if(this.connected_){let i={c:n};this.log_("reportStats",i),this.sendRequest("s",i,s=>{if(s.s!=="ok"){let o=s.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(n){if("r"in n){this.log_("from server: "+A(n));let i=n.r,s=this.requestCBHash_[i];s&&(delete this.requestCBHash_[i],s(n.b))}else{if("error"in n)throw"A server-side error has occurred: "+n.error;"a"in n&&this.onDataPush_(n.a,n.b)}}onDataPush_(n,i){this.log_("handleServerMessage",n,i),n==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):n==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):n==="c"?this.onListenRevoked_(i.p,i.q):n==="ac"?this.onAuthRevoked_(i.s,i.d):n==="apc"?this.onAppCheckRevoked_(i.s,i.d):n==="sd"?this.onSecurityDebugPacket_(i):ps("Unrecognized action received from server: "+A(n)+`
Are you using the latest client?`)}onReady_(n,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(n),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(n){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(n))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(n){n&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Rt,this.realtime_||this.scheduleConnect_(0)),this.visible_=n}onOnline_(n){n?(this.log_("Browser went online."),this.reconnectDelay_=Rt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Zd&&(this.reconnectDelay_=Rt),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let n=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),i=Math.max(0,this.reconnectDelay_-n);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Xd)}this.onConnectStatus_(!1)}establishConnection_(){return D(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let n=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+t.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,s())},d=function(h){f(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:d};let u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[h,_]=yield Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);a?M("getToken() completed but was canceled"):(M("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=_&&_.token,l=new ws(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,n,i,s,p=>{H(p+" ("+this.repoInfo_.toString()+")"),this.interrupt(Jd)},o))}catch(h){this.log_("Failed to get token: "+h),a||(this.repoInfo_.nodeAdmin&&H(h),c())}}})}interrupt(n){M("Interrupting connection for reason: "+n),this.interruptReasons_[n]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(n){M("Resuming connection for reason: "+n),delete this.interruptReasons_[n],Vi(this.interruptReasons_)&&(this.reconnectDelay_=Rt,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(n){let i=n-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let n=0;n<this.outstandingPuts_.length;n++){let i=this.outstandingPuts_[n];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[n],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(n,i){let s;i?s=i.map(o=>ar(o)).join("$"):s="default";let r=this.removeListen_(n,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(n,i){let s=new S(n).toString(),r;if(this.listens.has(s)){let o=this.listens.get(s);r=o.get(i),o.delete(i),o.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(n,i){M("Auth token revoked: "+n+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(n==="invalid_token"||n==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=fl&&(this.reconnectDelay_=dl,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(n,i){M("App check token revoked: "+n+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(n==="invalid_token"||n==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=fl&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(n){this.securityDebugCallback_?this.securityDebugCallback_(n):"msg"in n&&console.log("FIREBASE: "+n.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let n of this.listens.values())for(let i of n.values())this.sendListen_(i);for(let n=0;n<this.outstandingPuts_.length;n++)this.outstandingPuts_[n]&&this.sendPut_(n);for(;this.onDisconnectRequestQueue_.length;){let n=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(n.action,n.pathString,n.data,n.onComplete)}for(let n=0;n<this.outstandingGets_.length;n++)this.outstandingGets_[n]&&this.sendGet_(n)}sendConnectStats_(){let n={},i="js";X()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),n["sdk."+i+"."+cr.replace(/\./g,"-")]=1,qi()?n["framework.cordova"]=1:Na()&&(n["framework.reactnative"]=1),this.reportStats(n)}shouldReconnect_(){let n=Rn.getInstance().currentlyOnline();return Vi(this.interruptReasons_)&&n}}t.nextPersistentConnectionId_=0,t.nextConnectionId_=0;return t})(),y=class t{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new t(e,n)}};var Qe=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){let i=new y(Ye,e),s=new y(Ye,n);return this.compare(i,s)!==0}minPost(){return y.MIN}};var bn,On=class extends Qe{static get __EMPTY_NODE(){return bn}static set __EMPTY_NODE(e){bn=e}compare(e,n){return Le(e.name,n.name)}isDefinedOn(e){throw xe("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return y.MIN}maxPost(){return new y(De,bn)}makePost(e,n){return f(typeof e=="string","KeyIndex indexValue must always be a string."),new y(e,bn)}toString(){return".key"}},Ke=new On;var je=class{constructor(e,n,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?i(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},$=(()=>{class t{constructor(n,i,s,r,o){this.key=n,this.value=i,this.color=s??t.RED,this.left=r??z.EMPTY_NODE,this.right=o??z.EMPTY_NODE}copy(n,i,s,r,o){return new t(n??this.key,i??this.value,s??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(n){return this.left.inorderTraversal(n)||!!n(this.key,this.value)||this.right.inorderTraversal(n)}reverseTraversal(n){return this.right.reverseTraversal(n)||n(this.key,this.value)||this.left.reverseTraversal(n)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(n,i,s){let r=this,o=s(n,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(n,i,s),null):o===0?r=r.copy(null,i,null,null,null):r=r.copy(null,null,null,null,r.right.insert(n,i,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return z.EMPTY_NODE;let n=this;return!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.removeMin_(),null),n.fixUp_()}remove(n,i){let s,r;if(s=this,i(n,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(n,i),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),i(n,s.key)===0){if(s.right.isEmpty())return z.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(n,i))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let n=this;return n.right.isRed_()&&!n.left.isRed_()&&(n=n.rotateLeft_()),n.left.isRed_()&&n.left.left.isRed_()&&(n=n.rotateRight_()),n.left.isRed_()&&n.right.isRed_()&&(n=n.colorFlip_()),n}moveRedLeft_(){let n=this.colorFlip_();return n.right.left.isRed_()&&(n=n.copy(null,null,null,null,n.right.rotateRight_()),n=n.rotateLeft_(),n=n.colorFlip_()),n}moveRedRight_(){let n=this.colorFlip_();return n.left.left.isRed_()&&(n=n.rotateRight_(),n=n.colorFlip_()),n}rotateLeft_(){let n=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,n,null)}rotateRight_(){let n=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,n)}colorFlip_(){let n=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,n,i)}checkMaxDepth_(){let n=this.check_();return Math.pow(2,n)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let n=this.left.check_();if(n!==this.right.check_())throw new Error("Black depths differ");return n+(this.isRed_()?0:1)}}return t.RED=!0,t.BLACK=!1,t})(),Ts=class{copy(e,n,i,s,r){return this}insert(e,n,i){return new $(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},z=class t{constructor(e,n=t.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,$.BLACK,null,null))}remove(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,$.BLACK,null,null))}get(e){let n,i=this.root_;for(;!i.isEmpty();){if(n=this.comparator_(e,i.key),n===0)return i.value;n<0?i=i.left:n>0&&(i=i.right)}return null}getPredecessorKey(e){let n,i=this.root_,s=null;for(;!i.isEmpty();)if(n=this.comparator_(e,i.key),n===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else n<0?i=i.left:n>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new je(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new je(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new je(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new je(this.root_,null,this.comparator_,!0,e)}};z.EMPTY_NODE=new Ts;function ef(t,e){return Le(t.name,e.name)}function fr(t,e){return Le(t,e)}var Is;function tf(t){Is=t}var ec=function(t){return typeof t=="number"?"number:"+Gl(t):"string:"+t},tc=function(t){if(t.isLeafNode()){let e=t.val();f(typeof e=="string"||typeof e=="number"||typeof e=="object"&&j(e,".sv"),"Priority must be a string or number.")}else f(t===Is||t.isEmpty(),"priority of unexpected type.");f(t===Is||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var _l,Xe=(()=>{class t{static set __childrenNodeConstructor(n){_l=n}static get __childrenNodeConstructor(){return _l}constructor(n,i=t.__childrenNodeConstructor.EMPTY_NODE){this.value_=n,this.priorityNode_=i,this.lazyHash_=null,f(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),tc(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(n){return new t(this.value_,n)}getImmediateChild(n){return n===".priority"?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE}getChild(n){return E(n)?this:v(n)===".priority"?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(n,i){return null}updateImmediateChild(n,i){return n===".priority"?this.updatePriority(i):i.isEmpty()&&n!==".priority"?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(n,i).updatePriority(this.priorityNode_)}updateChild(n,i){let s=v(n);return s===null?i:i.isEmpty()&&s!==".priority"?this:(f(s!==".priority"||me(n)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(N(n),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(n,i){return!1}val(n){return n&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let n="";this.priorityNode_.isEmpty()||(n+="priority:"+ec(this.priorityNode_.val())+":");let i=typeof this.value_;n+=i+":",i==="number"?n+=Gl(this.value_):n+=this.value_,this.lazyHash_=Vl(n)}return this.lazyHash_}getValue(){return this.value_}compareTo(n){return n===t.__childrenNodeConstructor.EMPTY_NODE?1:n instanceof t.__childrenNodeConstructor?-1:(f(n.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(n))}compareToLeafNode_(n){let i=typeof n.value_,s=typeof this.value_,r=t.VALUE_TYPE_ORDER.indexOf(i),o=t.VALUE_TYPE_ORDER.indexOf(s);return f(r>=0,"Unknown leaf type: "+i),f(o>=0,"Unknown leaf type: "+s),r===o?s==="object"?0:this.value_<n.value_?-1:this.value_===n.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(n){if(n===this)return!0;if(n.isLeafNode()){let i=n;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}t.VALUE_TYPE_ORDER=["object","boolean","number","string"];return t})(),nc,ic;function nf(t){nc=t}function sf(t){ic=t}var Ns=class extends Qe{compare(e,n){let i=e.node.getPriority(),s=n.node.getPriority(),r=i.compareTo(s);return r===0?Le(e.name,n.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return y.MIN}maxPost(){return new y(De,new Xe("[PRIORITY-POST]",ic))}makePost(e,n){let i=nc(e);return new y(n,new Xe("[PRIORITY-POST]",i))}toString(){return".priority"}},O=new Ns;var rf=Math.log(2),xs=class{constructor(e){let n=r=>parseInt(Math.log(r)/rf,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;let s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},An=function(t,e,n,i){t.sort(e);let s=function(l,c){let d=c-l,u,h;if(d===0)return null;if(d===1)return u=t[l],h=n?n(u):u,new $(h,u.node,$.BLACK,null,null);{let _=parseInt(d/2,10)+l,p=s(l,_),C=s(_+1,c);return u=t[_],h=n?n(u):u,new $(h,u.node,$.BLACK,p,C)}},r=function(l){let c=null,d=null,u=t.length,h=function(p,C){let k=u-p,ne=u;u-=p;let ie=s(k+1,ne),ve=t[k],ii=n?n(ve):ve;_(new $(ii,ve.node,C,null,ie))},_=function(p){c?(c.left=p,c=p):(d=p,c=p)};for(let p=0;p<l.count;++p){let C=l.nextBitIsOne(),k=Math.pow(2,l.count-(p+1));C?h(k,$.BLACK):(h(k,$.BLACK),h(k,$.RED))}return d},o=new xs(t.length),a=r(o);return new z(i||e,a)};var as,Ge={},Ze=class t{static get Default(){return f(Ge&&O,"ChildrenNode.ts has not been loaded"),as=as||new t({".priority":Ge},{".priority":O}),as}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){let n=Re(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof z?n:null}hasIndex(e){return j(this.indexSet_,e.toString())}addIndex(e,n){f(e!==Ke,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],s=!1,r=n.getIterator(y.Wrap),o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();let a;s?a=An(i,e.getCompare()):a=Ge;let l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;let d=Object.assign({},this.indexes_);return d[l]=a,new t(d,c)}addToIndexes(e,n){let i=Et(this.indexes_,(s,r)=>{let o=Re(this.indexSet_,r);if(f(o,"Missing index implementation for "+r),s===Ge)if(o.isDefinedOn(e.node)){let a=[],l=n.getIterator(y.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),An(a,o.getCompare())}else return Ge;else{let a=n.get(e.name),l=s;return a&&(l=l.remove(new y(e.name,a))),l.insert(e,e.node)}});return new t(i,this.indexSet_)}removeFromIndexes(e,n){let i=Et(this.indexes_,s=>{if(s===Ge)return s;{let r=n.get(e.name);return r?s.remove(new y(e.name,r)):s}});return new t(i,this.indexSet_)}};var Ot,g=(()=>{class t{static get EMPTY_NODE(){return Ot||(Ot=new t(new z(fr),null,Ze.Default))}constructor(n,i,s){this.children_=n,this.priorityNode_=i,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&tc(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ot}updatePriority(n){return this.children_.isEmpty()?this:new t(this.children_,n,this.indexMap_)}getImmediateChild(n){if(n===".priority")return this.getPriority();{let i=this.children_.get(n);return i===null?Ot:i}}getChild(n){let i=v(n);return i===null?this:this.getImmediateChild(i).getChild(N(n))}hasChild(n){return this.children_.get(n)!==null}updateImmediateChild(n,i){if(f(i,"We should always be passing snapshot nodes"),n===".priority")return this.updatePriority(i);{let s=new y(n,i),r,o;i.isEmpty()?(r=this.children_.remove(n),o=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(n,i),o=this.indexMap_.addToIndexes(s,this.children_));let a=r.isEmpty()?Ot:this.priorityNode_;return new t(r,a,o)}}updateChild(n,i){let s=v(n);if(s===null)return i;{f(v(n)!==".priority"||me(n)===1,".priority must be the last token in a path");let r=this.getImmediateChild(s).updateChild(N(n),i);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;let i={},s=0,r=0,o=!0;if(this.forEachChild(O,(a,l)=>{i[a]=l.val(n),s++,o&&t.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!n&&o&&r<2*s){let a=[];for(let l in i)a[l]=i[l];return a}else return n&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let n="";this.getPriority().isEmpty()||(n+="priority:"+ec(this.getPriority().val())+":"),this.forEachChild(O,(i,s)=>{let r=s.hash();r!==""&&(n+=":"+i+":"+r)}),this.lazyHash_=n===""?"":Vl(n)}return this.lazyHash_}getPredecessorChildName(n,i,s){let r=this.resolveIndex_(s);if(r){let o=r.getPredecessorKey(new y(n,i));return o?o.name:null}else return this.children_.getPredecessorKey(n)}getFirstChildName(n){let i=this.resolveIndex_(n);if(i){let s=i.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(n){let i=this.getFirstChildName(n);return i?new y(i,this.children_.get(i)):null}getLastChildName(n){let i=this.resolveIndex_(n);if(i){let s=i.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(n){let i=this.getLastChildName(n);return i?new y(i,this.children_.get(i)):null}forEachChild(n,i){let s=this.resolveIndex_(n);return s?s.inorderTraversal(r=>i(r.name,r.node)):this.children_.inorderTraversal(i)}getIterator(n){return this.getIteratorFrom(n.minPost(),n)}getIteratorFrom(n,i){let s=this.resolveIndex_(i);if(s)return s.getIteratorFrom(n,r=>r);{let r=this.children_.getIteratorFrom(n.name,y.Wrap),o=r.peek();for(;o!=null&&i.compare(o,n)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(n){return this.getReverseIteratorFrom(n.maxPost(),n)}getReverseIteratorFrom(n,i){let s=this.resolveIndex_(i);if(s)return s.getReverseIteratorFrom(n,r=>r);{let r=this.children_.getReverseIteratorFrom(n.name,y.Wrap),o=r.peek();for(;o!=null&&i.compare(o,n)>0;)r.getNext(),o=r.peek();return r}}compareTo(n){return this.isEmpty()?n.isEmpty()?0:-1:n.isLeafNode()||n.isEmpty()?1:n===Yt?-1:0}withIndex(n){if(n===Ke||this.indexMap_.hasIndex(n))return this;{let i=this.indexMap_.addIndex(n,this.children_);return new t(this.children_,this.priorityNode_,i)}}isIndexed(n){return n===Ke||this.indexMap_.hasIndex(n)}equals(n){if(n===this)return!0;if(n.isLeafNode())return!1;{let i=n;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let s=this.getIterator(O),r=i.getIterator(O),o=s.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=s.getNext(),a=r.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(n){return n===Ke?null:this.indexMap_.get(n.toString())}}return t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t})(),Rs=class extends g{constructor(){super(new z(fr),g.EMPTY_NODE,Ze.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return g.EMPTY_NODE}isEmpty(){return!1}},Yt=new Rs;Object.defineProperties(y,{MIN:{value:new y(Ye,g.EMPTY_NODE)},MAX:{value:new y(De,Yt)}});On.__EMPTY_NODE=g.EMPTY_NODE;Xe.__childrenNodeConstructor=g;tf(Yt);sf(Yt);var of=!0;function P(t,e=null){if(t===null)return g.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),f(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){let n=t;return new Xe(n,P(e))}if(!(t instanceof Array)&&of){let n=[],i=!1;if(L(t,(o,a)=>{if(o.substring(0,1)!=="."){let l=P(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),n.push(new y(o,l)))}}),n.length===0)return g.EMPTY_NODE;let r=An(n,ef,o=>o.name,fr);if(i){let o=An(n,O.getCompare());return new g(r,P(e),new Ze({".priority":o},{".priority":O}))}else return new g(r,P(e),Ze.Default)}else{let n=g.EMPTY_NODE;return L(t,(i,s)=>{if(j(t,i)&&i.substring(0,1)!=="."){let r=P(s);(r.isLeafNode()||!r.isEmpty())&&(n=n.updateImmediateChild(i,r))}}),n.updatePriority(P(e))}}nf(P);var Os=class extends Qe{constructor(e){super(),this.indexPath_=e,f(!E(e)&&v(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){let i=this.extractChild(e.node),s=this.extractChild(n.node),r=i.compareTo(s);return r===0?Le(e.name,n.name):r}makePost(e,n){let i=P(e),s=g.EMPTY_NODE.updateChild(this.indexPath_,i);return new y(n,s)}maxPost(){let e=g.EMPTY_NODE.updateChild(this.indexPath_,Yt);return new y(De,e)}toString(){return Bt(this.indexPath_,0).join("/")}};var As=class extends Qe{compare(e,n){let i=e.node.compareTo(n.node);return i===0?Le(e.name,n.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return y.MIN}maxPost(){return y.MAX}makePost(e,n){let i=P(e);return new y(n,i)}toString(){return".value"}},af=new As;function sc(t){return{type:"value",snapshotNode:t}}function Je(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Ut(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Ht(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function lf(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}var Wt=class{constructor(e){this.index_=e}updateChild(e,n,i,s,r,o){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(n);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(n)?o.trackChildChange(Ut(n,a)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Je(n,i)):o.trackChildChange(Ht(n,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(n,i).withIndex(this.index_)}updateFullNode(e,n,i){return i!=null&&(e.isLeafNode()||e.forEachChild(O,(s,r)=>{n.hasChild(s)||i.trackChildChange(Ut(s,r))}),n.isLeafNode()||n.forEachChild(O,(s,r)=>{if(e.hasChild(s)){let o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(Ht(s,r,o))}else i.trackChildChange(Je(s,r))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?g.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var kn=class t{constructor(e){this.indexedFilter_=new Wt(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&i}updateChild(e,n,i,s,r,o){return this.matches(new y(n,i))||(i=g.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,i,s,r,o)}updateFullNode(e,n,i){n.isLeafNode()&&(n=g.EMPTY_NODE);let s=n.withIndex(this.index_);s=s.updatePriority(g.EMPTY_NODE);let r=this;return n.forEachChild(O,(o,a)=>{r.matches(new y(o,a))||(s=s.updateImmediateChild(o,g.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}};var ks=class{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=n=>{let i=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new kn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,i,s,r,o){return this.rangedFilter_.matches(new y(n,i))||(i=g.EMPTY_NODE),e.getImmediateChild(n).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,i,s,r,o):this.fullLimitUpdateChild_(e,n,i,r,o)}updateFullNode(e,n,i){let s;if(n.isLeafNode()||n.isEmpty())s=g.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){s=g.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){let a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=n.withIndex(this.index_),s=s.updatePriority(g.EMPTY_NODE);let r;this.reverse_?r=s.getReverseIterator(this.index_):r=s.getIterator(this.index_);let o=0;for(;r.hasNext();){let a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,g.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,i,s,r){let o;if(this.reverse_){let u=this.index_.getCompare();o=(h,_)=>u(_,h)}else o=this.index_.getCompare();let a=e;f(a.numChildren()===this.limit_,"");let l=new y(n,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(l);if(a.hasChild(n)){let u=a.getImmediateChild(n),h=s.getChildAfterChild(this.index_,c,this.reverse_);for(;h!=null&&(h.name===n||a.hasChild(h.name));)h=s.getChildAfterChild(this.index_,h,this.reverse_);let _=h==null?1:o(h,l);if(d&&!i.isEmpty()&&_>=0)return r?.trackChildChange(Ht(n,i,u)),a.updateImmediateChild(n,i);{r?.trackChildChange(Ut(n,u));let C=a.updateImmediateChild(n,g.EMPTY_NODE);return h!=null&&this.rangedFilter_.matches(h)?(r?.trackChildChange(Je(h.name,h.node)),C.updateImmediateChild(h.name,h.node)):C}}else return i.isEmpty()?e:d&&o(c,l)>=0?(r!=null&&(r.trackChildChange(Ut(c.name,c.node)),r.trackChildChange(Je(n,i))),a.updateImmediateChild(n,i).updateImmediateChild(c.name,g.EMPTY_NODE)):e}};var Ps=class t{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=O}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ye}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:De}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===O}copy(){let e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function cf(t){return t.loadsAllData()?new Wt(t.getIndex()):t.hasLimit()?new ks(t):new kn(t)}function pl(t){let e={};if(t.isDefault())return e;let n;if(t.index_===O?n="$priority":t.index_===af?n="$value":t.index_===Ke?n="$key":(f(t.index_ instanceof Os,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=A(n),t.startSet_){let i=t.startAfterSet_?"startAfter":"startAt";e[i]=A(t.indexStartValue_),t.startNameSet_&&(e[i]+=","+A(t.indexStartName_))}if(t.endSet_){let i=t.endBeforeSet_?"endBefore":"endAt";e[i]=A(t.indexEndValue_),t.endNameSet_&&(e[i]+=","+A(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function ml(t){let e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==O&&(e.i=t.index_.toString()),e}var Ds=class t extends Nn{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=Kt("p:rest:"),this.listens_={}}listen(e,n,i,s){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let o=t.getListenId_(e,i),a={};this.listens_[o]=a;let l=pl(e._queryParams);this.restRequest_(r+".json",l,(c,d)=>{let u=d;if(c===404&&(u=null,c=null),c===null&&this.onDataUpdate_(r,u,!1,i),Re(this.listens_,o)===a){let h;c?c===401?h="permission_denied":h="rest_error:"+c:h="ok",s(h,null)}})}unlisten(e,n){let i=t.getListenId_(e,n);delete this.listens_[i]}get(e){let n=pl(e._queryParams),i=e._path.toString(),s=new se;return this.restRequest_(i+".json",n,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},i){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(n.auth=s.accessToken),r&&r.token&&(n.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Pa(n);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=qe(a.responseText)}catch{H("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&H("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var Ms=class{constructor(){this.rootNode_=g.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}};function Pn(){return{value:null,children:new Map}}function rc(t,e,n){if(E(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{let i=v(e);t.children.has(i)||t.children.set(i,Pn());let s=t.children.get(i);e=N(e),rc(s,e,n)}}function Ls(t,e,n){t.value!==null?n(e,t.value):hf(t,(i,s)=>{let r=new S(e.toString()+"/"+i);Ls(s,r,n)})}function hf(t,e){t.children.forEach((n,i)=>{e(i,n)})}var Fs=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),n=Object.assign({},e);return this.last_&&L(this.last_,(i,s)=>{n[i]=n[i]-s}),this.last_=e,n}};var gl=10*1e3,uf=30*1e3,df=300*1e3,Bs=class{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new Fs(e);let i=gl+(uf-gl)*Math.random();kt(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),n={},i=!1;L(e,(s,r)=>{r>0&&j(this.statsToReport_,s)&&(n[s]=r,i=!0)}),i&&this.server_.reportStats(n),kt(this.reportStats_.bind(this),Math.floor(Math.random()*2*df))}};var J=(function(t){return t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",t})(J||{});function _r(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function pr(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function mr(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}var Us=class t{constructor(e,n,i){this.path=e,this.affectedTree=n,this.revert=i,this.type=J.ACK_USER_WRITE,this.source=_r()}operationForChild(e){if(E(this.path)){if(this.affectedTree.value!=null)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let n=this.affectedTree.subtree(new S(e));return new t(w(),n,this.revert)}}else return f(v(this.path)===e,"operationForChild called for unrelated child."),new t(N(this.path),this.affectedTree,this.revert)}};var Dn=class t{constructor(e,n){this.source=e,this.path=n,this.type=J.LISTEN_COMPLETE}operationForChild(e){return E(this.path)?new t(this.source,w()):new t(this.source,N(this.path))}};var et=class t{constructor(e,n,i){this.source=e,this.path=n,this.snap=i,this.type=J.OVERWRITE}operationForChild(e){return E(this.path)?new t(this.source,w(),this.snap.getImmediateChild(e)):new t(this.source,N(this.path),this.snap)}};var qt=class t{constructor(e,n,i){this.source=e,this.path=n,this.children=i,this.type=J.MERGE}operationForChild(e){if(E(this.path)){let n=this.children.subtree(new S(e));return n.isEmpty()?null:n.value?new et(this.source,w(),n.value):new t(this.source,w(),n)}else return f(v(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,N(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var ee=class{constructor(e,n,i){this.node_=e,this.fullyInitialized_=n,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(E(e))return this.isFullyInitialized()&&!this.filtered_;let n=v(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Hs=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function ff(t,e,n,i){let s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(lf(o.childName,o.snapshotNode))}),At(t,s,"child_removed",e,i,n),At(t,s,"child_added",e,i,n),At(t,s,"child_moved",r,i,n),At(t,s,"child_changed",e,i,n),At(t,s,"value",e,i,n),s}function At(t,e,n,i,s,r){let o=i.filter(a=>a.type===n);o.sort((a,l)=>pf(t,a,l)),o.forEach(a=>{let l=_f(t,a,r);s.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,t.query_))})})}function _f(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function pf(t,e,n){if(e.childName==null||n.childName==null)throw xe("Should only compare child_ events.");let i=new y(e.childName,e.snapshotNode),s=new y(n.childName,n.snapshotNode);return t.index_.compare(i,s)}function Kn(t,e){return{eventCache:t,serverCache:e}}function Dt(t,e,n,i){return Kn(new ee(e,n,i),t.serverCache)}function oc(t,e,n,i){return Kn(t.eventCache,new ee(e,n,i))}function Mn(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Me(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}var ls,mf=()=>(ls||(ls=new z(fd)),ls),W=class t{static fromObject(e){let n=new t(null);return L(e,(i,s)=>{n=n.set(new S(i),s)}),n}constructor(e,n=mf()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:w(),value:this.value};if(E(e))return null;{let i=v(e),s=this.children.get(i);if(s!==null){let r=s.findRootMostMatchingPathAndValue(N(e),n);return r!=null?{path:R(new S(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(E(e))return this;{let n=v(e),i=this.children.get(n);return i!==null?i.subtree(N(e)):new t(null)}}set(e,n){if(E(e))return new t(n,this.children);{let i=v(e),r=(this.children.get(i)||new t(null)).set(N(e),n),o=this.children.insert(i,r);return new t(this.value,o)}}remove(e){if(E(e))return this.children.isEmpty()?new t(null):new t(null,this.children);{let n=v(e),i=this.children.get(n);if(i){let s=i.remove(N(e)),r;return s.isEmpty()?r=this.children.remove(n):r=this.children.insert(n,s),this.value===null&&r.isEmpty()?new t(null):new t(this.value,r)}else return this}}get(e){if(E(e))return this.value;{let n=v(e),i=this.children.get(n);return i?i.get(N(e)):null}}setTree(e,n){if(E(e))return n;{let i=v(e),r=(this.children.get(i)||new t(null)).setTree(N(e),n),o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new t(this.value,o)}}fold(e){return this.fold_(w(),e)}fold_(e,n){let i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(R(e,s),n)}),n(e,this.value,i)}findOnPath(e,n){return this.findOnPath_(e,w(),n)}findOnPath_(e,n,i){let s=this.value?i(n,this.value):!1;if(s)return s;if(E(e))return null;{let r=v(e),o=this.children.get(r);return o?o.findOnPath_(N(e),R(n,r),i):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,w(),n)}foreachOnPath_(e,n,i){if(E(e))return this;{this.value&&i(n,this.value);let s=v(e),r=this.children.get(s);return r?r.foreachOnPath_(N(e),R(n,s),i):new t(null)}}foreach(e){this.foreach_(w(),e)}foreach_(e,n){this.children.inorderTraversal((i,s)=>{s.foreach_(R(e,i),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,i)=>{i.value&&e(n,i.value)})}};var K=class t{constructor(e){this.writeTree_=e}static empty(){return new t(new W(null))}};function Mt(t,e,n){if(E(e))return new K(new W(n));{let i=t.writeTree_.findRootMostValueAndPath(e);if(i!=null){let s=i.path,r=i.value,o=U(s,e);return r=r.updateChild(o,n),new K(t.writeTree_.set(s,r))}else{let s=new W(n),r=t.writeTree_.setTree(e,s);return new K(r)}}}function Ws(t,e,n){let i=t;return L(n,(s,r)=>{i=Mt(i,R(e,s),r)}),i}function vl(t,e){if(E(e))return K.empty();{let n=t.writeTree_.setTree(e,new W(null));return new K(n)}}function qs(t,e){return Fe(t,e)!=null}function Fe(t,e){let n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(U(n.path,e)):null}function yl(t){let e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(O,(i,s)=>{e.push(new y(i,s))}):t.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new y(i,s.value))}),e}function _e(t,e){if(E(e))return t;{let n=Fe(t,e);return n!=null?new K(new W(n)):new K(t.writeTree_.subtree(e))}}function Vs(t){return t.writeTree_.isEmpty()}function tt(t,e){return ac(w(),t.writeTree_,e)}function ac(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(f(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):n=ac(R(t,s),r,n)}),!n.getChild(t).isEmpty()&&i!==null&&(n=n.updateChild(R(t,".priority"),i)),n}}function Yn(t,e){return uc(e,t)}function gf(t,e,n,i,s){f(i>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:i,visible:s}),s&&(t.visibleWrites=Mt(t.visibleWrites,e,n)),t.lastWriteId=i}function vf(t,e,n,i){f(i>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:i,visible:!0}),t.visibleWrites=Ws(t.visibleWrites,e,n),t.lastWriteId=i}function yf(t,e){for(let n=0;n<t.allWrites.length;n++){let i=t.allWrites[n];if(i.writeId===e)return i}return null}function Ef(t,e){let n=t.allWrites.findIndex(a=>a.writeId===e);f(n>=0,"removeWrite called with nonexistent writeId.");let i=t.allWrites[n];t.allWrites.splice(n,1);let s=i.visible,r=!1,o=t.allWrites.length-1;for(;s&&o>=0;){let a=t.allWrites[o];a.visible&&(o>=n&&Cf(a,i.path)?s=!1:V(i.path,a.path)&&(r=!0)),o--}if(s){if(r)return wf(t),!0;if(i.snap)t.visibleWrites=vl(t.visibleWrites,i.path);else{let a=i.children;L(a,l=>{t.visibleWrites=vl(t.visibleWrites,R(i.path,l))})}return!0}else return!1}function Cf(t,e){if(t.snap)return V(t.path,e);for(let n in t.children)if(t.children.hasOwnProperty(n)&&V(R(t.path,n),e))return!0;return!1}function wf(t){t.visibleWrites=lc(t.allWrites,Sf,w()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function Sf(t){return t.visible}function lc(t,e,n){let i=K.empty();for(let s=0;s<t.length;++s){let r=t[s];if(e(r)){let o=r.path,a;if(r.snap)V(n,o)?(a=U(n,o),i=Mt(i,a,r.snap)):V(o,n)&&(a=U(o,n),i=Mt(i,w(),r.snap.getChild(a)));else if(r.children){if(V(n,o))a=U(n,o),i=Ws(i,a,r.children);else if(V(o,n))if(a=U(o,n),E(a))i=Ws(i,w(),r.children);else{let l=Re(r.children,v(a));if(l){let c=l.getChild(N(a));i=Mt(i,w(),c)}}}else throw xe("WriteRecord should have .snap or .children")}}return i}function cc(t,e,n,i,s){if(!i&&!s){let r=Fe(t.visibleWrites,e);if(r!=null)return r;{let o=_e(t.visibleWrites,e);if(Vs(o))return n;if(n==null&&!qs(o,w()))return null;{let a=n||g.EMPTY_NODE;return tt(o,a)}}}else{let r=_e(t.visibleWrites,e);if(!s&&Vs(r))return n;if(!s&&n==null&&!qs(r,w()))return null;{let o=function(c){return(c.visible||s)&&(!i||!~i.indexOf(c.writeId))&&(V(c.path,e)||V(e,c.path))},a=lc(t.allWrites,o,e),l=n||g.EMPTY_NODE;return tt(a,l)}}}function bf(t,e,n){let i=g.EMPTY_NODE,s=Fe(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(O,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(n){let r=_e(t.visibleWrites,e);return n.forEachChild(O,(o,a)=>{let l=tt(_e(r,new S(o)),a);i=i.updateImmediateChild(o,l)}),yl(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let r=_e(t.visibleWrites,e);return yl(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function Tf(t,e,n,i,s){f(i||s,"Either existingEventSnap or existingServerSnap must exist");let r=R(e,n);if(qs(t.visibleWrites,r))return null;{let o=_e(t.visibleWrites,r);return Vs(o)?s.getChild(n):tt(o,s.getChild(n))}}function If(t,e,n,i){let s=R(e,n),r=Fe(t.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(n)){let o=_e(t.visibleWrites,s);return tt(o,i.getNode().getImmediateChild(n))}else return null}function Nf(t,e){return Fe(t.visibleWrites,e)}function xf(t,e,n,i,s,r,o){let a,l=_e(t.visibleWrites,e),c=Fe(l,w());if(c!=null)a=c;else if(n!=null)a=tt(l,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],u=o.getCompare(),h=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),_=h.getNext();for(;_&&d.length<s;)u(_,i)!==0&&d.push(_),_=h.getNext();return d}else return[]}function Rf(){return{visibleWrites:K.empty(),allWrites:[],lastWriteId:-1}}function Ln(t,e,n,i){return cc(t.writeTree,t.treePath,e,n,i)}function gr(t,e){return bf(t.writeTree,t.treePath,e)}function El(t,e,n,i){return Tf(t.writeTree,t.treePath,e,n,i)}function Fn(t,e){return Nf(t.writeTree,R(t.treePath,e))}function Of(t,e,n,i,s,r){return xf(t.writeTree,t.treePath,e,n,i,s,r)}function vr(t,e,n){return If(t.writeTree,t.treePath,e,n)}function hc(t,e){return uc(R(t.treePath,e),t.writeTree)}function uc(t,e){return{treePath:t,writeTree:e}}var zs=class{constructor(){this.changeMap=new Map}trackChildChange(e){let n=e.type,i=e.childName;f(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),f(i!==".priority","Only non-priority child changes can be tracked.");let s=this.changeMap.get(i);if(s){let r=s.type;if(n==="child_added"&&r==="child_removed")this.changeMap.set(i,Ht(i,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(n==="child_removed"&&r==="child_changed")this.changeMap.set(i,Ut(i,s.oldSnap));else if(n==="child_changed"&&r==="child_added")this.changeMap.set(i,Je(i,e.snapshotNode));else if(n==="child_changed"&&r==="child_changed")this.changeMap.set(i,Ht(i,e.snapshotNode,s.oldSnap));else throw xe("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};var Gs=class{getCompleteChild(e){return null}getChildAfterChild(e,n,i){return null}},dc=new Gs,Vt=class{constructor(e,n,i=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=i}getCompleteChild(e){let n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new ee(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return vr(this.writes_,e,i)}}getChildAfterChild(e,n,i){let s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Me(this.viewCache_),r=Of(this.writes_,s,n,1,i,e);return r.length===0?null:r[0]}};function Af(t){return{filter:t}}function kf(t,e){f(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),f(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function Pf(t,e,n,i,s){let r=new zs,o,a;if(n.type===J.OVERWRITE){let c=n;c.source.fromUser?o=js(t,e,c.path,c.snap,i,s,r):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!E(c.path),o=Bn(t,e,c.path,c.snap,i,s,a,r))}else if(n.type===J.MERGE){let c=n;c.source.fromUser?o=Mf(t,e,c.path,c.children,i,s,r):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=$s(t,e,c.path,c.children,i,s,a,r))}else if(n.type===J.ACK_USER_WRITE){let c=n;c.revert?o=Bf(t,e,c.path,i,s,r):o=Lf(t,e,c.path,c.affectedTree,i,s,r)}else if(n.type===J.LISTEN_COMPLETE)o=Ff(t,e,n.path,i,r);else throw xe("Unknown operation type: "+n.type);let l=r.getChanges();return Df(e,o,l),{viewCache:o,changes:l}}function Df(t,e,n){let i=e.eventCache;if(i.isFullyInitialized()){let s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=Mn(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&n.push(sc(Mn(e)))}}function fc(t,e,n,i,s,r){let o=e.eventCache;if(Fn(i,n)!=null)return e;{let a,l;if(E(n))if(f(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=Me(e),d=c instanceof g?c:g.EMPTY_NODE,u=gr(i,d);a=t.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{let c=Ln(i,Me(e));a=t.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{let c=v(n);if(c===".priority"){f(me(n)===1,"Can't have a priority with additional path components");let d=o.getNode();l=e.serverCache.getNode();let u=El(i,n,d,l);u!=null?a=t.filter.updatePriority(d,u):a=o.getNode()}else{let d=N(n),u;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let h=El(i,n,o.getNode(),l);h!=null?u=o.getNode().getImmediateChild(c).updateChild(d,h):u=o.getNode().getImmediateChild(c)}else u=vr(i,c,e.serverCache);u!=null?a=t.filter.updateChild(o.getNode(),c,u,d,s,r):a=o.getNode()}}return Dt(e,a,o.isFullyInitialized()||E(n),t.filter.filtersNodes())}}function Bn(t,e,n,i,s,r,o,a){let l=e.serverCache,c,d=o?t.filter:t.filter.getIndexedFilter();if(E(n))c=d.updateFullNode(l.getNode(),i,null);else if(d.filtersNodes()&&!l.isFiltered()){let _=l.getNode().updateChild(n,i);c=d.updateFullNode(l.getNode(),_,null)}else{let _=v(n);if(!l.isCompleteForPath(n)&&me(n)>1)return e;let p=N(n),k=l.getNode().getImmediateChild(_).updateChild(p,i);_===".priority"?c=d.updatePriority(l.getNode(),k):c=d.updateChild(l.getNode(),_,k,p,dc,null)}let u=oc(e,c,l.isFullyInitialized()||E(n),d.filtersNodes()),h=new Vt(s,u,r);return fc(t,u,n,s,h,a)}function js(t,e,n,i,s,r,o){let a=e.eventCache,l,c,d=new Vt(s,e,r);if(E(n))c=t.filter.updateFullNode(e.eventCache.getNode(),i,o),l=Dt(e,c,!0,t.filter.filtersNodes());else{let u=v(n);if(u===".priority")c=t.filter.updatePriority(e.eventCache.getNode(),i),l=Dt(e,c,a.isFullyInitialized(),a.isFiltered());else{let h=N(n),_=a.getNode().getImmediateChild(u),p;if(E(h))p=i;else{let C=d.getCompleteChild(u);C!=null?hr(h)===".priority"&&C.getChild(Zl(h)).isEmpty()?p=C:p=C.updateChild(h,i):p=g.EMPTY_NODE}if(_.equals(p))l=e;else{let C=t.filter.updateChild(a.getNode(),u,p,h,d,o);l=Dt(e,C,a.isFullyInitialized(),t.filter.filtersNodes())}}}return l}function Cl(t,e){return t.eventCache.isCompleteForChild(e)}function Mf(t,e,n,i,s,r,o){let a=e;return i.foreach((l,c)=>{let d=R(n,l);Cl(e,v(d))&&(a=js(t,a,d,c,s,r,o))}),i.foreach((l,c)=>{let d=R(n,l);Cl(e,v(d))||(a=js(t,a,d,c,s,r,o))}),a}function wl(t,e,n){return n.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function $s(t,e,n,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;E(n)?c=i:c=new W(null).setTree(n,i);let d=e.serverCache.getNode();return c.children.inorderTraversal((u,h)=>{if(d.hasChild(u)){let _=e.serverCache.getNode().getImmediateChild(u),p=wl(t,_,h);l=Bn(t,l,new S(u),p,s,r,o,a)}}),c.children.inorderTraversal((u,h)=>{let _=!e.serverCache.isCompleteForChild(u)&&h.value===null;if(!d.hasChild(u)&&!_){let p=e.serverCache.getNode().getImmediateChild(u),C=wl(t,p,h);l=Bn(t,l,new S(u),C,s,r,o,a)}}),l}function Lf(t,e,n,i,s,r,o){if(Fn(s,n)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(i.value!=null){if(E(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return Bn(t,e,n,l.getNode().getChild(n),s,r,a,o);if(E(n)){let c=new W(null);return l.getNode().forEachChild(Ke,(d,u)=>{c=c.set(new S(d),u)}),$s(t,e,n,c,s,r,a,o)}else return e}else{let c=new W(null);return i.foreach((d,u)=>{let h=R(n,d);l.isCompleteForPath(h)&&(c=c.set(d,l.getNode().getChild(h)))}),$s(t,e,n,c,s,r,a,o)}}function Ff(t,e,n,i,s){let r=e.serverCache,o=oc(e,r.getNode(),r.isFullyInitialized()||E(n),r.isFiltered());return fc(t,o,n,i,dc,s)}function Bf(t,e,n,i,s,r){let o;if(Fn(i,n)!=null)return e;{let a=new Vt(i,e,s),l=e.eventCache.getNode(),c;if(E(n)||v(n)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=Ln(i,Me(e));else{let u=e.serverCache.getNode();f(u instanceof g,"serverChildren would be complete if leaf node"),d=gr(i,u)}d=d,c=t.filter.updateFullNode(l,d,r)}else{let d=v(n),u=vr(i,d,e.serverCache);u==null&&e.serverCache.isCompleteForChild(d)&&(u=l.getImmediateChild(d)),u!=null?c=t.filter.updateChild(l,d,u,N(n),a,r):e.eventCache.getNode().hasChild(d)?c=t.filter.updateChild(l,d,g.EMPTY_NODE,N(n),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Ln(i,Me(e)),o.isLeafNode()&&(c=t.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||Fn(i,w())!=null,Dt(e,c,o,t.filter.filtersNodes())}}var Ks=class{constructor(e,n){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,s=new Wt(i.getIndex()),r=cf(i);this.processor_=Af(r);let o=n.serverCache,a=n.eventCache,l=s.updateFullNode(g.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(g.EMPTY_NODE,a.getNode(),null),d=new ee(l,o.isFullyInitialized(),s.filtersNodes()),u=new ee(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=Kn(u,d),this.eventGenerator_=new Hs(this.query_)}get query(){return this.query_}};function Uf(t){return t.viewCache_.serverCache.getNode()}function Hf(t){return Mn(t.viewCache_)}function Wf(t,e){let n=Me(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!E(e)&&!n.getImmediateChild(v(e)).isEmpty())?n.getChild(e):null}function Sl(t){return t.eventRegistrations_.length===0}function qf(t,e){t.eventRegistrations_.push(e)}function bl(t,e,n){let i=[];if(n){f(e==null,"A cancel should cancel all event registrations.");let s=t.query._path;t.eventRegistrations_.forEach(r=>{let o=r.createCancelEvent(n,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<t.eventRegistrations_.length;++r){let o=t.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(r+1));break}}t.eventRegistrations_=s}else t.eventRegistrations_=[];return i}function Tl(t,e,n,i){e.type===J.MERGE&&e.source.queryId!==null&&(f(Me(t.viewCache_),"We should always have a full cache before handling merges"),f(Mn(t.viewCache_),"Missing event cache, even though we have a server cache"));let s=t.viewCache_,r=Pf(t.processor_,s,e,n,i);return kf(t.processor_,r.viewCache),f(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,_c(t,r.changes,r.viewCache.eventCache.getNode(),null)}function Vf(t,e){let n=t.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(O,(r,o)=>{i.push(Je(r,o))}),n.isFullyInitialized()&&i.push(sc(n.getNode())),_c(t,i,n.getNode(),e)}function _c(t,e,n,i){let s=i?[i]:t.eventRegistrations_;return ff(t.eventGenerator_,e,n,s)}var Un,Hn=class{constructor(){this.views=new Map}};function zf(t){f(!Un,"__referenceConstructor has already been defined"),Un=t}function Gf(){return f(Un,"Reference.ts has not been loaded"),Un}function jf(t){return t.views.size===0}function yr(t,e,n,i){let s=e.source.queryId;if(s!==null){let r=t.views.get(s);return f(r!=null,"SyncTree gave us an op for an invalid query."),Tl(r,e,n,i)}else{let r=[];for(let o of t.views.values())r=r.concat(Tl(o,e,n,i));return r}}function pc(t,e,n,i,s){let r=e._queryIdentifier,o=t.views.get(r);if(!o){let a=Ln(n,s?i:null),l=!1;a?l=!0:i instanceof g?(a=gr(n,i),l=!1):(a=g.EMPTY_NODE,l=!1);let c=Kn(new ee(a,l,!1),new ee(i,s,!1));return new Ks(e,c)}return o}function $f(t,e,n,i,s,r){let o=pc(t,e,i,s,r);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),qf(o,n),Vf(o,n)}function Kf(t,e,n,i){let s=e._queryIdentifier,r=[],o=[],a=ge(t);if(s==="default")for(let[l,c]of t.views.entries())o=o.concat(bl(c,n,i)),Sl(c)&&(t.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{let l=t.views.get(s);l&&(o=o.concat(bl(l,n,i)),Sl(l)&&(t.views.delete(s),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!ge(t)&&r.push(new(Gf())(e._repo,e._path)),{removed:r,events:o}}function mc(t){let e=[];for(let n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function pe(t,e){let n=null;for(let i of t.views.values())n=n||Wf(i,e);return n}function gc(t,e){if(e._queryParams.loadsAllData())return Qn(t);{let i=e._queryIdentifier;return t.views.get(i)}}function vc(t,e){return gc(t,e)!=null}function ge(t){return Qn(t)!=null}function Qn(t){for(let e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Wn;function Yf(t){f(!Wn,"__referenceConstructor has already been defined"),Wn=t}function Qf(){return f(Wn,"Reference.ts has not been loaded"),Wn}var Xf=1,qn=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new W(null),this.pendingWriteTree_=Rf(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function yc(t,e,n,i,s){return gf(t.pendingWriteTree_,e,n,i,s),s?rt(t,new et(_r(),e,n)):[]}function Zf(t,e,n,i){vf(t.pendingWriteTree_,e,n,i);let s=W.fromObject(n);return rt(t,new qt(_r(),e,s))}function fe(t,e,n=!1){let i=yf(t.pendingWriteTree_,e);if(Ef(t.pendingWriteTree_,e)){let r=new W(null);return i.snap!=null?r=r.set(w(),!0):L(i.children,o=>{r=r.set(new S(o),!0)}),rt(t,new Us(i.path,r,n))}else return[]}function Qt(t,e,n){return rt(t,new et(pr(),e,n))}function Jf(t,e,n){let i=W.fromObject(n);return rt(t,new qt(pr(),e,i))}function e_(t,e){return rt(t,new Dn(pr(),e))}function t_(t,e,n){let i=Cr(t,n);if(i){let s=wr(i),r=s.path,o=s.queryId,a=U(r,e),l=new Dn(mr(o),a);return Sr(t,r,l)}else return[]}function Vn(t,e,n,i,s=!1){let r=e._path,o=t.syncPointTree_.get(r),a=[];if(o&&(e._queryIdentifier==="default"||vc(o,e))){let l=Kf(o,e,n,i);jf(o)&&(t.syncPointTree_=t.syncPointTree_.remove(r));let c=l.removed;if(a=l.events,!s){let d=c.findIndex(h=>h._queryParams.loadsAllData())!==-1,u=t.syncPointTree_.findOnPath(r,(h,_)=>ge(_));if(d&&!u){let h=t.syncPointTree_.subtree(r);if(!h.isEmpty()){let _=s_(h);for(let p=0;p<_.length;++p){let C=_[p],k=C.query,ne=Sc(t,C);t.listenProvider_.startListening(Lt(k),zt(t,k),ne.hashFn,ne.onComplete)}}}!u&&c.length>0&&!i&&(d?t.listenProvider_.stopListening(Lt(e),null):c.forEach(h=>{let _=t.queryToTagMap.get(Xn(h));t.listenProvider_.stopListening(Lt(h),_)}))}r_(t,c)}return a}function Ec(t,e,n,i){let s=Cr(t,i);if(s!=null){let r=wr(s),o=r.path,a=r.queryId,l=U(o,e),c=new et(mr(a),l,n);return Sr(t,o,c)}else return[]}function n_(t,e,n,i){let s=Cr(t,i);if(s){let r=wr(s),o=r.path,a=r.queryId,l=U(o,e),c=W.fromObject(n),d=new qt(mr(a),l,c);return Sr(t,o,d)}else return[]}function Ys(t,e,n,i=!1){let s=e._path,r=null,o=!1;t.syncPointTree_.foreachOnPath(s,(h,_)=>{let p=U(h,s);r=r||pe(_,p),o=o||ge(_)});let a=t.syncPointTree_.get(s);a?(o=o||ge(a),r=r||pe(a,w())):(a=new Hn,t.syncPointTree_=t.syncPointTree_.set(s,a));let l;r!=null?l=!0:(l=!1,r=g.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((_,p)=>{let C=pe(p,w());C&&(r=r.updateImmediateChild(_,C))}));let c=vc(a,e);if(!c&&!e._queryParams.loadsAllData()){let h=Xn(e);f(!t.queryToTagMap.has(h),"View does not exist, but we have a tag");let _=o_();t.queryToTagMap.set(h,_),t.tagToQueryMap.set(_,h)}let d=Yn(t.pendingWriteTree_,s),u=$f(a,e,n,d,r,l);if(!c&&!o&&!i){let h=gc(a,e);u=u.concat(a_(t,e,h))}return u}function Er(t,e,n){let s=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,(o,a)=>{let l=U(o,e),c=pe(a,l);if(c)return c});return cc(s,e,r,n,!0)}function i_(t,e){let n=e._path,i=null;t.syncPointTree_.foreachOnPath(n,(c,d)=>{let u=U(c,n);i=i||pe(d,u)});let s=t.syncPointTree_.get(n);s?i=i||pe(s,w()):(s=new Hn,t.syncPointTree_=t.syncPointTree_.set(n,s));let r=i!=null,o=r?new ee(i,!0,!1):null,a=Yn(t.pendingWriteTree_,e._path),l=pc(s,e,a,r?o.getNode():g.EMPTY_NODE,r);return Hf(l)}function rt(t,e){return Cc(e,t.syncPointTree_,null,Yn(t.pendingWriteTree_,w()))}function Cc(t,e,n,i){if(E(t.path))return wc(t,e,n,i);{let s=e.get(w());n==null&&s!=null&&(n=pe(s,w()));let r=[],o=v(t.path),a=t.operationForChild(o),l=e.children.get(o);if(l&&a){let c=n?n.getImmediateChild(o):null,d=hc(i,o);r=r.concat(Cc(a,l,c,d))}return s&&(r=r.concat(yr(s,t,i,n))),r}}function wc(t,e,n,i){let s=e.get(w());n==null&&s!=null&&(n=pe(s,w()));let r=[];return e.children.inorderTraversal((o,a)=>{let l=n?n.getImmediateChild(o):null,c=hc(i,o),d=t.operationForChild(o);d&&(r=r.concat(wc(d,a,l,c)))}),s&&(r=r.concat(yr(s,t,i,n))),r}function Sc(t,e){let n=e.query,i=zt(t,n);return{hashFn:()=>(Uf(e)||g.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?t_(t,n._path,i):e_(t,n._path);{let r=md(s,n);return Vn(t,n,null,r)}}}}function zt(t,e){let n=Xn(e);return t.queryToTagMap.get(n)}function Xn(t){return t._path.toString()+"$"+t._queryIdentifier}function Cr(t,e){return t.tagToQueryMap.get(e)}function wr(t){let e=t.indexOf("$");return f(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new S(t.substr(0,e))}}function Sr(t,e,n){let i=t.syncPointTree_.get(e);f(i,"Missing sync point for query tag that we're tracking");let s=Yn(t.pendingWriteTree_,e);return yr(i,n,s,null)}function s_(t){return t.fold((e,n,i)=>{if(n&&ge(n))return[Qn(n)];{let s=[];return n&&(s=mc(n)),L(i,(r,o)=>{s=s.concat(o)}),s}})}function Lt(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(Qf())(t._repo,t._path):t}function r_(t,e){for(let n=0;n<e.length;++n){let i=e[n];if(!i._queryParams.loadsAllData()){let s=Xn(i),r=t.queryToTagMap.get(s);t.queryToTagMap.delete(s),t.tagToQueryMap.delete(r)}}}function o_(){return Xf++}function a_(t,e,n){let i=e._path,s=zt(t,e),r=Sc(t,n),o=t.listenProvider_.startListening(Lt(e),s,r.hashFn,r.onComplete),a=t.syncPointTree_.subtree(i);if(s)f(!ge(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,d,u)=>{if(!E(c)&&d&&ge(d))return[Qn(d).query];{let h=[];return d&&(h=h.concat(mc(d).map(_=>_.query))),L(u,(_,p)=>{h=h.concat(p)}),h}});for(let c=0;c<l.length;++c){let d=l[c];t.listenProvider_.stopListening(Lt(d),zt(t,d))}}return o}var Qs=class t{constructor(e){this.node_=e}getImmediateChild(e){let n=this.node_.getImmediateChild(e);return new t(n)}node(){return this.node_}},Xs=class t{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){let n=R(this.path_,e);return new t(this.syncTree_,n)}node(){return Er(this.syncTree_,this.path_)}},l_=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},Il=function(t,e,n){if(!t||typeof t!="object")return t;if(f(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return c_(t[".sv"],e,n);if(typeof t[".sv"]=="object")return h_(t[".sv"],e);f(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},c_=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:f(!1,"Unexpected server value: "+t)}},h_=function(t,e,n){t.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(t,null,2));let i=t.increment;typeof i!="number"&&f(!1,"Unexpected increment value: "+i);let s=e.node();if(f(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;let o=s.getValue();return typeof o!="number"?i:o+i},bc=function(t,e,n,i){return br(e,new Xs(n,t),i)},Tc=function(t,e,n){return br(t,new Qs(e),n)};function br(t,e,n){let i=t.getPriority().val(),s=Il(i,e.getImmediateChild(".priority"),n),r;if(t.isLeafNode()){let o=t,a=Il(o.getValue(),e,n);return a!==o.getValue()||s!==o.getPriority().val()?new Xe(a,P(s)):t}else{let o=t;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new Xe(s))),o.forEachChild(O,(a,l)=>{let c=br(l,e.getImmediateChild(a),n);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}var Gt=class{constructor(e="",n=null,i={children:{},childCount:0}){this.name=e,this.parent=n,this.node=i}};function Tr(t,e){let n=e instanceof S?e:new S(e),i=t,s=v(n);for(;s!==null;){let r=Re(i.node.children,s)||{children:{},childCount:0};i=new Gt(s,i,r),n=N(n),s=v(n)}return i}function ot(t){return t.node.value}function Ic(t,e){t.node.value=e,Zs(t)}function Nc(t){return t.node.childCount>0}function u_(t){return ot(t)===void 0&&!Nc(t)}function Zn(t,e){L(t.node.children,(n,i)=>{e(new Gt(n,t,i))})}function xc(t,e,n,i){n&&!i&&e(t),Zn(t,s=>{xc(s,e,!0,i)}),n&&i&&e(t)}function d_(t,e,n){let i=n?t:t.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function Xt(t){return new S(t.parent===null?t.name:Xt(t.parent)+"/"+t.name)}function Zs(t){t.parent!==null&&f_(t.parent,t.name,t)}function f_(t,e,n){let i=u_(n),s=j(t.node.children,e);i&&s?(delete t.node.children[e],t.node.childCount--,Zs(t)):!i&&!s&&(t.node.children[e]=n.node,t.node.childCount++,Zs(t))}var __=/[\[\].#$\/\u0000-\u001F\u007F]/,p_=/[\[\].#$\u0000-\u001F\u007F]/,cs=10*1024*1024,Ir=function(t){return typeof t=="string"&&t.length!==0&&!__.test(t)},Rc=function(t){return typeof t=="string"&&t.length!==0&&!p_.test(t)},m_=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Rc(t)},g_=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!or(t)||t&&typeof t=="object"&&j(t,".sv")},Oc=function(t,e,n,i){i&&e===void 0||Jn(Ct(t,"value"),e,n)},Jn=function(t,e,n){let i=n instanceof S?new Ss(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+Ae(i));if(typeof e=="function")throw new Error(t+"contains a function "+Ae(i)+" with contents = "+e.toString());if(or(e))throw new Error(t+"contains "+e.toString()+" "+Ae(i));if(typeof e=="string"&&e.length>cs/3&&wt(e)>cs)throw new Error(t+"contains a string greater than "+cs+" utf8 bytes "+Ae(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(L(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Ir(o)))throw new Error(t+" contains an invalid key ("+o+") "+Ae(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Kd(i,o),Jn(t,a,i),Yd(i)}),s&&r)throw new Error(t+' contains ".value" child '+Ae(i)+" in addition to actual children.")}},v_=function(t,e){let n,i;for(n=0;n<e.length;n++){i=e[n];let r=Bt(i);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!Ir(r[o]))throw new Error(t+"contains an invalid key ("+r[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort($d);let s=null;for(n=0;n<e.length;n++){if(i=e[n],s!==null&&V(s,i))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}},y_=function(t,e,n,i){if(i&&e===void 0)return;let s=Ct(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");let r=[];L(e,(o,a)=>{let l=new S(o);if(Jn(s,a,R(n,l)),hr(l)===".priority"&&!g_(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(l)}),v_(s,r)};var Ac=function(t,e,n,i){if(!(i&&n===void 0)&&!Rc(n))throw new Error(Ct(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},E_=function(t,e,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Ac(t,e,n,i)},Nr=function(t,e){if(v(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},C_=function(t,e){let n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Ir(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!m_(n))throw new Error(Ct(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Js=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function ei(t,e){let n=null;for(let i=0;i<e.length;i++){let s=e[i],r=s.getPath();n!==null&&!ur(r,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:r}),n.events.push(s)}n&&t.eventLists_.push(n)}function kc(t,e,n){ei(t,n),Pc(t,i=>ur(i,e))}function G(t,e,n){ei(t,n),Pc(t,i=>V(i,e)||V(e,i))}function Pc(t,e){t.recursionDepth_++;let n=!0;for(let i=0;i<t.eventLists_.length;i++){let s=t.eventLists_[i];if(s){let r=s.path;e(r)?(w_(t.eventLists_[i]),t.eventLists_[i]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function w_(t){for(let e=0;e<t.events.length;e++){let n=t.events[e];if(n!==null){t.events[e]=null;let i=n.getEventRunner();Pe&&M("event: "+n.toString()),st(i)}}}var S_="repo_interrupt",b_=25,er=class{constructor(e,n,i,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Js,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Pn(),this.transactionQueueTree_=new Gt,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function T_(t,e,n){if(t.stats_=lr(t.repoInfo_),t.forceRestClient_||Ed())t.server_=new Ds(t.repoInfo_,(i,s,r,o)=>{Nl(t,i,s,r,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>xl(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{A(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}t.persistentConnection_=new dr(t.repoInfo_,e,(i,s,r,o)=>{Nl(t,i,s,r,o)},i=>{xl(t,i)},i=>{I_(t,i)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(i=>{t.server_.refreshAuthToken(i)}),t.appCheckProvider_.addTokenChangeListener(i=>{t.server_.refreshAppCheckToken(i.token)}),t.statsReporter_=wd(t.repoInfo_,()=>new Bs(t.stats_,t.server_)),t.infoData_=new Ms,t.infoSyncTree_=new qn({startListening:(i,s,r,o)=>{let a=[],l=t.infoData_.getNode(i._path);return l.isEmpty()||(a=Qt(t.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),xr(t,"connected",!1),t.serverSyncTree_=new qn({startListening:(i,s,r,o)=>(t.server_.listen(i,r,s,(a,l)=>{let c=o(a,l);G(t.eventQueue_,i._path,c)}),[]),stopListening:(i,s)=>{t.server_.unlisten(i,s)}})}function Dc(t){let n=t.infoData_.getNode(new S(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function ti(t){return l_({timestamp:Dc(t)})}function Nl(t,e,n,i,s){t.dataUpdateCount++;let r=new S(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(i){let l=Et(n,c=>P(c));o=n_(t.serverSyncTree_,r,l,s)}else{let l=P(n);o=Ec(t.serverSyncTree_,r,l,s)}else if(i){let l=Et(n,c=>P(c));o=Jf(t.serverSyncTree_,r,l)}else{let l=P(n);o=Qt(t.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=nt(t,r)),G(t.eventQueue_,a,o)}function xl(t,e){xr(t,"connected",e),e===!1&&O_(t)}function I_(t,e){L(e,(n,i)=>{xr(t,n,i)})}function xr(t,e,n){let i=new S("/.info/"+e),s=P(n);t.infoData_.updateSnapshot(i,s);let r=Qt(t.infoSyncTree_,i,s);G(t.eventQueue_,i,r)}function Rr(t){return t.nextWriteId_++}function N_(t,e,n){let i=i_(t.serverSyncTree_,e);return i!=null?Promise.resolve(i):t.server_.get(e).then(s=>{let r=P(s).withIndex(e._queryParams.getIndex());Ys(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=Qt(t.serverSyncTree_,e._path,r);else{let a=zt(t.serverSyncTree_,e);o=Ec(t.serverSyncTree_,e._path,r,a)}return G(t.eventQueue_,e._path,o),Vn(t.serverSyncTree_,e,n,null,!0),r},s=>(Zt(t,"get for query "+A(e)+" failed: "+s),Promise.reject(new Error(s))))}function x_(t,e,n,i,s){Zt(t,"set",{path:e.toString(),value:n,priority:i});let r=ti(t),o=P(n,i),a=Er(t.serverSyncTree_,e),l=Tc(o,a,r),c=Rr(t),d=yc(t.serverSyncTree_,e,l,c,!0);ei(t.eventQueue_,d),t.server_.put(e.toString(),o.val(!0),(h,_)=>{let p=h==="ok";p||H("set at "+e+" failed: "+h);let C=fe(t.serverSyncTree_,c,!p);G(t.eventQueue_,e,C),tr(t,s,h,_)});let u=Ar(t,e);nt(t,u),G(t.eventQueue_,u,[])}function R_(t,e,n,i){Zt(t,"update",{path:e.toString(),value:n});let s=!0,r=ti(t),o={};if(L(n,(a,l)=>{s=!1,o[a]=bc(R(e,a),P(l),t.serverSyncTree_,r)}),s)M("update() called with empty data.  Don't do anything."),tr(t,i,"ok",void 0);else{let a=Rr(t),l=Zf(t.serverSyncTree_,e,o,a);ei(t.eventQueue_,l),t.server_.merge(e.toString(),n,(c,d)=>{let u=c==="ok";u||H("update at "+e+" failed: "+c);let h=fe(t.serverSyncTree_,a,!u),_=h.length>0?nt(t,e):e;G(t.eventQueue_,_,h),tr(t,i,c,d)}),L(n,c=>{let d=Ar(t,R(e,c));nt(t,d)}),G(t.eventQueue_,e,[])}}function O_(t){Zt(t,"onDisconnectEvents");let e=ti(t),n=Pn();Ls(t.onDisconnect_,w(),(s,r)=>{let o=bc(s,r,t.serverSyncTree_,e);rc(n,s,o)});let i=[];Ls(n,w(),(s,r)=>{i=i.concat(Qt(t.serverSyncTree_,s,r));let o=Ar(t,s);nt(t,o)}),t.onDisconnect_=Pn(),G(t.eventQueue_,w(),i)}function A_(t,e,n){let i;v(e._path)===".info"?i=Ys(t.infoSyncTree_,e,n):i=Ys(t.serverSyncTree_,e,n),kc(t.eventQueue_,e._path,i)}function Rl(t,e,n){let i;v(e._path)===".info"?i=Vn(t.infoSyncTree_,e,n):i=Vn(t.serverSyncTree_,e,n),kc(t.eventQueue_,e._path,i)}function k_(t){t.persistentConnection_&&t.persistentConnection_.interrupt(S_)}function Zt(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),M(n,...e)}function tr(t,e,n,i){e&&st(()=>{if(n==="ok")e(null);else{let s=(n||"error").toUpperCase(),r=s;i&&(r+=": "+i);let o=new Error(r);o.code=s,e(o)}})}function Mc(t,e,n){return Er(t.serverSyncTree_,e,n)||g.EMPTY_NODE}function Or(t,e=t.transactionQueueTree_){if(e||ni(t,e),ot(e)){let n=Fc(t,e);f(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&P_(t,Xt(e),n)}else Nc(e)&&Zn(e,n=>{Or(t,n)})}function P_(t,e,n){let i=n.map(c=>c.currentWriteId),s=Mc(t,e,i),r=s,o=s.hash();for(let c=0;c<n.length;c++){let d=n[c];f(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let u=U(e,d.path);r=r.updateChild(u,d.currentOutputSnapshotRaw)}let a=r.val(!0),l=e;t.server_.put(l.toString(),a,c=>{Zt(t,"transaction put response",{path:l.toString(),status:c});let d=[];if(c==="ok"){let u=[];for(let h=0;h<n.length;h++)n[h].status=2,d=d.concat(fe(t.serverSyncTree_,n[h].currentWriteId)),n[h].onComplete&&u.push(()=>n[h].onComplete(null,!0,n[h].currentOutputSnapshotResolved)),n[h].unwatcher();ni(t,Tr(t.transactionQueueTree_,e)),Or(t,t.transactionQueueTree_),G(t.eventQueue_,e,d);for(let h=0;h<u.length;h++)st(u[h])}else{if(c==="datastale")for(let u=0;u<n.length;u++)n[u].status===3?n[u].status=4:n[u].status=0;else{H("transaction at "+l.toString()+" failed: "+c);for(let u=0;u<n.length;u++)n[u].status=4,n[u].abortReason=c}nt(t,e)}},o)}function nt(t,e){let n=Lc(t,e),i=Xt(n),s=Fc(t,n);return D_(t,s,i),i}function D_(t,e,n){if(e.length===0)return;let i=[],s=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=U(n,l.path),d=!1,u;if(f(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)d=!0,u=l.abortReason,s=s.concat(fe(t.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=b_)d=!0,u="maxretry",s=s.concat(fe(t.serverSyncTree_,l.currentWriteId,!0));else{let h=Mc(t,l.path,o);l.currentInputSnapshot=h;let _=e[a].update(h.val());if(_!==void 0){Jn("transaction failed: Data returned ",_,l.path);let p=P(_);typeof _=="object"&&_!=null&&j(_,".priority")||(p=p.updatePriority(h.getPriority()));let k=l.currentWriteId,ne=ti(t),ie=Tc(p,h,ne);l.currentOutputSnapshotRaw=p,l.currentOutputSnapshotResolved=ie,l.currentWriteId=Rr(t),o.splice(o.indexOf(k),1),s=s.concat(yc(t.serverSyncTree_,l.path,ie,l.currentWriteId,l.applyLocally)),s=s.concat(fe(t.serverSyncTree_,k,!0))}else d=!0,u="nodata",s=s.concat(fe(t.serverSyncTree_,l.currentWriteId,!0))}G(t.eventQueue_,n,s),s=[],d&&(e[a].status=2,(function(h){setTimeout(h,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(u==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(u),!1,null))))}ni(t,t.transactionQueueTree_);for(let a=0;a<i.length;a++)st(i[a]);Or(t,t.transactionQueueTree_)}function Lc(t,e){let n,i=t.transactionQueueTree_;for(n=v(e);n!==null&&ot(i)===void 0;)i=Tr(i,n),e=N(e),n=v(e);return i}function Fc(t,e){let n=[];return Bc(t,e,n),n.sort((i,s)=>i.order-s.order),n}function Bc(t,e,n){let i=ot(e);if(i)for(let s=0;s<i.length;s++)n.push(i[s]);Zn(e,s=>{Bc(t,s,n)})}function ni(t,e){let n=ot(e);if(n){let i=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[i]=n[s],i++);n.length=i,Ic(e,n.length>0?n:void 0)}Zn(e,i=>{ni(t,i)})}function Ar(t,e){let n=Xt(Lc(t,e)),i=Tr(t.transactionQueueTree_,e);return d_(i,s=>{hs(t,s)}),hs(t,i),xc(i,s=>{hs(t,s)}),n}function hs(t,e){let n=ot(e);if(n){let i=[],s=[],r=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(f(r===o-1,"All SENT items should be at beginning of queue."),r=o,n[o].status=3,n[o].abortReason="set"):(f(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat(fe(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&i.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Ic(e,void 0):n.length=r+1,G(t.eventQueue_,Xt(e),s);for(let o=0;o<i.length;o++)st(i[o])}}function M_(t){let e="",n=t.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let s=n[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function L_(t){let e={};t.charAt(0)==="?"&&(t=t.substring(1));for(let n of t.split("&")){if(n.length===0)continue;let i=n.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):H(`Invalid query segment '${n}' in query '${t}'`)}return e}var Ol=function(t,e){let n=F_(t),i=n.namespace;n.domain==="firebase.com"&&ae(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&n.domain!=="localhost"&&ae("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||ud();let s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new In(n.host,n.secure,i,s,e,"",i!==n.subdomain),path:new S(n.pathString)}},F_=function(t){let e="",n="",i="",s="",r="",o=!0,a="https",l=443;if(typeof t=="string"){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let d=t.indexOf("/");d===-1&&(d=t.length);let u=t.indexOf("?");u===-1&&(u=t.length),e=t.substring(0,Math.min(d,u)),d<u&&(s=M_(t.substring(d,u)));let h=L_(t.substring(Math.min(t.length,u)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let _=e.slice(0,c);if(_.toLowerCase()==="localhost")n="localhost";else if(_.split(".").length<=2)n=_;else{let p=e.indexOf(".");i=e.substring(0,p).toLowerCase(),n=e.substring(p+1),r=i}"ns"in h&&(r=h.ns)}return{host:e,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};var Al="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",B_=(function(){let t=0,e=[];return function(n){let i=n===t;t=n;let s,r=new Array(8);for(s=7;s>=0;s--)r[s]=Al.charAt(n%64),n=Math.floor(n/64);f(n===0,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=Al.charAt(e[s]);return f(o.length===20,"nextPushId: Length should be 20."),o}})();var zn=class{constructor(e,n,i,s){this.eventType=e,this.eventRegistration=n,this.snapshot=i,this.prevName=s}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+A(this.snapshot.exportVal())}},Gn=class{constructor(e,n,i){this.eventRegistration=e,this.error=n,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var jn=class{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var nr=class t{constructor(e,n,i,s){this._repo=e,this._path=n,this._queryParams=i,this._orderByCalled=s}get key(){return E(this._path)?null:hr(this._path)}get ref(){return new te(this._repo,this._path)}get _queryIdentifier(){let e=ml(this._queryParams),n=ar(e);return n==="{}"?"default":n}get _queryObject(){return ml(this._queryParams)}isEqual(e){if(e=he(e),!(e instanceof t))return!1;let n=this._repo===e._repo,i=ur(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+jd(this._path)}};var te=class t extends nr{constructor(e,n){super(e,n,new Ps,!1)}get parent(){let e=Zl(this._path);return e===null?null:new t(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},jt=class t{constructor(e,n,i){this._node=e,this.ref=n,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let n=new S(e),i=it(this.ref,e);return new t(this._node.getChild(n),i,O)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new t(s,it(this.ref,i),O)))}hasChild(e){let n=new S(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function rm(t,e){return t=he(t),t._checkNotDeleted("ref"),e!==void 0?it(t._root,e):t._root}function it(t,e){return t=he(t),v(t._path)===null?E_("child","path",e,!1):Ac("child","path",e,!1),new te(t._repo,R(t._path,e))}function om(t,e){t=he(t),Nr("push",t._path),Oc("push",e,t._path,!0);let n=Dc(t._repo),i=B_(n),s=it(t,i),r=it(t,i),o;return e!=null?o=Uc(r,e).then(()=>r):o=Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function am(t){return Nr("remove",t._path),Uc(t,null)}function Uc(t,e){t=he(t),Nr("set",t._path),Oc("set",e,t._path,!1);let n=new se;return x_(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function lm(t,e){y_("update",e,t._path,!1);let n=new se;return R_(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function cm(t){t=he(t);let e=new jn(()=>{}),n=new $n(e);return N_(t._repo,t,n).then(i=>new jt(i,new te(t._repo,t._path),t._queryParams.getIndex()))}var $n=class t{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){let i=n._queryParams.getIndex();return new zn("value",this,new jt(e.snapshotNode,new te(n._repo,n._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new Gn(this,e,n):null}matches(e){return e instanceof t?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},ir=class t{constructor(e,n){this.eventType=e,this.callbackContext=n}respondsTo(e){let n=e==="children_added"?"child_added":e;return n=n==="children_removed"?"child_removed":n,this.eventType===n}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new Gn(this,e,n):null}createEvent(e,n){f(e.childName!=null,"Child events should have a childName.");let i=it(new te(n._repo,n._path),e.childName),s=n._queryParams.getIndex();return new zn(e.type,this,new jt(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof t?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function U_(t,e,n,i,s){let r;if(typeof i=="object"&&(r=void 0,s=i),typeof i=="function"&&(r=i),s&&s.onlyOnce){let l=n,c=(d,u)=>{Rl(t._repo,t,a),l(d,u)};c.userCallback=n.userCallback,c.context=n.context,n=c}let o=new jn(n,r||void 0),a=e==="value"?new $n(o):new ir(e,o);return A_(t._repo,t,a),()=>Rl(t._repo,t,a)}function hm(t,e,n,i){return U_(t,"value",e,n,i)}zf(te);Yf(te);var H_="FIREBASE_DATABASE_EMULATOR_HOST",sr={},W_=!1;function q_(t,e,n,i){let s=e.lastIndexOf(":"),r=e.substring(0,s),o=En(r);t.repoInfo_=new In(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),i&&(t.authTokenProvider_=i)}function V_(t,e,n,i,s){let r=i||t.options.databaseURL;r===void 0&&(t.options.projectId||ae("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),M("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=Ol(r,s),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[H_]),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,o=Ol(r,s),a=o.repoInfo):l=!o.repoInfo.secure;let d=s&&l?new Pt(Pt.OWNER):new vs(t.name,t.options,e);C_("Invalid Firebase Database URL",o),E(o.path)||ae("Database URL must point to the root of a Firebase Database (not including a child path).");let u=G_(a,t,d,new gs(t,n));return new rr(u,t)}function z_(t,e){let n=sr[e];(!n||n[t.key]!==t)&&ae(`Database ${e}(${t.repoInfo_}) has already been deleted.`),k_(t),delete n[t.key]}function G_(t,e,n,i){let s=sr[e.name];s||(s={},sr[e.name]=s);let r=s[t.toURLString()];return r&&ae("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new er(t,W_,n,i),s[t.toURLString()]=r,r}var rr=class{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(T_(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new te(this._repo,w())),this._rootInternal}_delete(){return this._rootInternal!==null&&(z_(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ae("Cannot call "+e+" on a deleted database.")}};function Hc(t=Sn(),e){let n=$a(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){let i=Sa("database");i&&j_(n,...i)}return n}function j_(t,e,n,i={}){t=he(t),t._checkNotDeleted("useEmulator");let s=`${e}:${n}`,r=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&Ve(i,r.repoInfo_.emulatorOptions))return;ae("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&ae('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Pt(Pt.OWNER);else if(i.mockUserToken){let a=typeof i.mockUserToken=="string"?i.mockUserToken:Ta(i.mockUserToken,t.app.options.projectId);o=new Pt(a)}En(e)&&(ba(e),Ia("Database",!0)),q_(r,s,i,o)}function $_(t){Sd(Ya),Tt(new re("database",(e,{instanceIdentifier:n})=>{let i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return V_(i,s,r,n)},"PUBLIC").setMultipleInstances(!0)),de(tl,nl,t),de(tl,nl,"esm2017")}dr.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};dr.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};Id(kl.default.Client);$_("node");var K_="firebase",Y_="11.10.0";de(K_,Y_,"app");var Q_={apiKey:"AIzaSyDLrpLTvmqdthZlDs6B9GvK6RtxFfV3GyU",authDomain:"project-a2-7b9e8.firebaseapp.com",databaseURL:"https://project-a2-7b9e8-default-rtdb.europe-west1.firebasedatabase.app",projectId:"project-a2-7b9e8",storageBucket:"project-a2-7b9e8.firebasestorage.app",messagingSenderId:"423221934609",appId:"1:423221934609:web:126218f73b12c959f08fb0",measurementId:"G-PLSVLXGESZ"},X_=Qa().length?Sn():is(Q_),Sm=Hc(X_);export{gn as a,eu as b,En as c,ba as d,Ia as e,iu as f,qi as g,Rp as h,Op as i,Na as j,Ne as k,yt as l,Ve as m,Pa as n,Ap as o,he as p,re as q,I as r,ze as s,Tt as t,$a as u,Ka as v,Ya as w,Sn as x,de as y,rm as z,it as A,om as B,am as C,Uc as D,lm as E,cm as F,hm as G,Sm as H};
